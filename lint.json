[{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\(protected)\\analytics\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\(protected)\\dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle2' is defined but never used.","line":4,"column":49,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":61},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'XCircle' is defined but never used.","line":4,"column":70,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":77}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { TrendingUp, Users, Folder, LayoutGrid, CheckCircle2, Clock, XCircle, ArrowRight } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport Link from 'next/link';\r\nimport { Loader2 } from 'lucide-react';\r\n\r\ninterface ProjectStat {\r\n    id: string;\r\n    name: string;\r\n    description: string | null;\r\n    totalLeads: number;\r\n    statusCounts: Record<string, number>;\r\n    createdAt: string;\r\n}\r\n\r\ninterface DashboardData {\r\n    totalLeads: number;\r\n    totalProjects: number;\r\n    projectStats: ProjectStat[];\r\n}\r\n\r\nexport default function DashboardPage() {\r\n    const [data, setData] = useState<DashboardData | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        fetch('/api/dashboard/stats')\r\n            .then(res => {\r\n                if (!res.ok) throw new Error('Failed to fetch stats');\r\n                return res.json();\r\n            })\r\n            .then(setData)\r\n            .catch((err) => {\r\n                console.error(err);\r\n                toast.error('Failed to load dashboard stats');\r\n            })\r\n            .finally(() => setLoading(false));\r\n    }, []);\r\n\r\n    const getStatusColor = (status: string) => {\r\n        const s = status.toLowerCase();\r\n        if (s.includes('complete') || s.includes('qualified')) return 'text-green-400 bg-green-400/10 border-green-400/20';\r\n        if (s.includes('not interested') || s.includes('not qualified')) return 'text-red-400 bg-red-400/10 border-red-400/20';\r\n        if (s.includes('follow-up') || s.includes('qc')) return 'text-yellow-400 bg-yellow-400/10 border-yellow-400/20';\r\n        return 'text-blue-400 bg-blue-400/10 border-blue-400/20';\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"h-full flex flex-col items-center justify-center bg-slate-900\">\r\n                <Loader2 className=\"w-10 h-10 animate-spin text-blue-500 mb-4\" />\r\n                <p className=\"text-slate-400 animate-pulse\">Gathering intelligence...</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!data) return null;\r\n\r\n    return (\r\n        <div className=\"h-full flex flex-col bg-slate-900 overflow-y-auto pb-10\">\r\n            {/* Header */}\r\n            <div className=\"p-8 pb-4\">\r\n                <div className=\"max-w-7xl mx-auto w-full\">\r\n                    <h1 className=\"text-3xl font-bold text-white flex items-center gap-3\">\r\n                        <LayoutGrid className=\"w-8 h-8 text-blue-500\" />\r\n                        Executive Dashboard\r\n                    </h1>\r\n                    <p className=\"text-slate-400 mt-1\">Real-time performance metrics across all projects</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Overview Stats */}\r\n            <div className=\"px-8 py-4\">\r\n                <div className=\"max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\r\n                    <div className=\"bg-slate-800 border border-slate-700 p-6 rounded-2xl shadow-xl\">\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <div className=\"p-3 bg-blue-500/10 rounded-xl\">\r\n                                <Folder className=\"w-6 h-6 text-blue-400\" />\r\n                            </div>\r\n                            <div>\r\n                                <h3 className=\"text-slate-400 text-sm font-medium uppercase tracking-wider\">Total Projects</h3>\r\n                                <p className=\"text-3xl font-bold text-white mt-1\">{data.totalProjects}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"bg-slate-800 border border-slate-700 p-6 rounded-2xl shadow-xl\">\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <div className=\"p-3 bg-purple-500/10 rounded-xl\">\r\n                                <Users className=\"w-6 h-6 text-purple-400\" />\r\n                            </div>\r\n                            <div>\r\n                                <h3 className=\"text-slate-400 text-sm font-medium uppercase tracking-wider\">Total Leads</h3>\r\n                                <p className=\"text-3xl font-bold text-white mt-1\">{data.totalLeads}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    {/* Placeholder for other global metrics */}\r\n                    <div className=\"bg-slate-800 border border-slate-700 p-6 rounded-2xl shadow-xl\">\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <div className=\"p-3 bg-green-500/10 rounded-xl\">\r\n                                <TrendingUp className=\"w-6 h-6 text-green-400\" />\r\n                            </div>\r\n                            <div>\r\n                                <h3 className=\"text-slate-400 text-sm font-medium uppercase tracking-wider\">Avg Conversion</h3>\r\n                                <p className=\"text-3xl font-bold text-white mt-1\">12.5%</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"bg-slate-800 border border-slate-700 p-6 rounded-2xl shadow-xl\">\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <div className=\"p-3 bg-yellow-500/10 rounded-xl\">\r\n                                <Clock className=\"w-6 h-6 text-yellow-400\" />\r\n                            </div>\r\n                            <div>\r\n                                <h3 className=\"text-slate-400 text-sm font-medium uppercase tracking-wider\">Active Deals</h3>\r\n                                <p className=\"text-3xl font-bold text-white mt-1\">48</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Projects Detailed List */}\r\n            <div className=\"px-8 mt-10\">\r\n                <div className=\"max-w-7xl mx-auto\">\r\n                    <div className=\"flex items-center justify-between mb-6\">\r\n                        <h2 className=\"text-2xl font-bold text-white\">Project Performance</h2>\r\n                        <Link href=\"/leads\" className=\"text-sm text-blue-400 hover:text-blue-300 font-medium transition-colors\">\r\n                            Manage Projects â†’\r\n                        </Link>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-6\">\r\n                        {data.projectStats.map((project) => (\r\n                            <div key={project.id} className=\"bg-slate-800/50 border border-slate-700 rounded-3xl overflow-hidden backdrop-blur-sm transition-all hover:bg-slate-800\">\r\n                                <div className=\"p-8 flex flex-col lg:flex-row lg:items-center justify-between gap-8\">\r\n                                    <div className=\"flex-1\">\r\n                                        <div className=\"flex items-center gap-3 mb-2\">\r\n                                            <h3 className=\"text-2xl font-bold text-white\">{project.name}</h3>\r\n                                            <span className=\"px-2 py-1 bg-blue-500/10 text-blue-400 text-[10px] font-bold uppercase tracking-widest rounded border border-blue-500/20\">\r\n                                                ACTIVE\r\n                                            </span>\r\n                                        </div>\r\n                                        <p className=\"text-slate-400 text-sm max-w-xl\">\r\n                                            {project.description || 'No description available for this project.'}\r\n                                        </p>\r\n                                        <div className=\"mt-6 flex items-center gap-6\">\r\n                                            <div className=\"flex flex-col\">\r\n                                                <span className=\"text-[10px] text-slate-500 font-bold uppercase tracking-wider\">Leads</span>\r\n                                                <span className=\"text-xl font-bold text-white\">{project.totalLeads}</span>\r\n                                            </div>\r\n                                            <div className=\"w-px h-8 bg-slate-700\"></div>\r\n                                            <div className=\"flex flex-col\">\r\n                                                <span className=\"text-[10px] text-slate-500 font-bold uppercase tracking-wider\">Created</span>\r\n                                                <span className=\"text-sm font-medium text-slate-300\">{new Date(project.createdAt).toLocaleDateString()}</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"flex-1 grid grid-cols-2 sm:grid-cols-4 gap-4\">\r\n                                        {Object.entries(project.statusCounts).slice(0, 4).map(([status, count]) => (\r\n                                            <div key={status} className={`p-4 rounded-2xl border ${getStatusColor(status)} flex flex-col gap-1`}>\r\n                                                <span className=\"text-[10px] font-bold uppercase tracking-wider opacity-80\">{status}</span>\r\n                                                <span className=\"text-xl font-bold\">{count}</span>\r\n                                            </div>\r\n                                        ))}\r\n                                        {Object.keys(project.statusCounts).length === 0 && (\r\n                                            <div className=\"col-span-4 py-4 text-slate-500 text-sm text-center bg-slate-900/30 rounded-2xl border border-dashed border-slate-700\">\r\n                                                No lead activity yet\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n\r\n                                    <Link\r\n                                        href={`/leads/${project.id}`}\r\n                                        className=\"bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-2xl flex items-center justify-center transition-all shadow-lg shadow-blue-900/30 active:scale-95 group\"\r\n                                    >\r\n                                        <ArrowRight className=\"w-6 h-6 group-hover:translate-x-1 transition-transform\" />\r\n                                    </Link>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n\r\n                        {data.projectStats.length === 0 && (\r\n                            <div className=\"py-20 flex flex-col items-center justify-center text-center bg-slate-800/30 rounded-3xl border-2 border-dashed border-slate-700\">\r\n                                <LayoutGrid className=\"w-12 h-12 text-slate-600 mb-4\" />\r\n                                <h3 className=\"text-xl font-bold text-white\">Dashboard Empty</h3>\r\n                                <p className=\"text-slate-400 mt-2 max-w-xs px-4\">Create a project and add some leads to see visual analytics here.</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\(protected)\\layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[446,449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[446,449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Sidebar from '@/components/layout/Sidebar'\r\nimport { getSession } from '@/lib/auth'\r\nimport { redirect } from 'next/navigation'\r\n\r\nexport default async function ProtectedLayout({\r\n    children,\r\n}: {\r\n    children: React.ReactNode\r\n}) {\r\n    const session = await getSession()\r\n    if (!session) redirect('/login')\r\n\r\n    return (\r\n        <div className=\"flex min-h-screen bg-slate-950 text-white\">\r\n            <Sidebar user={session as any} />\r\n            <main className=\"flex-1 overflow-auto bg-slate-950\">\r\n                <div className=\"h-full p-8\">\r\n                    {children}\r\n                </div>\r\n            </main>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\(protected)\\leads\\[projectId]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[703,706],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[703,706],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1256,1259],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1256,1259],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1930,1933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1930,1933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2394,2397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2394,2397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":106,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":106,"endColumn":23}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect, use } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport LeadGrid from '@/components/leads/LeadGrid';\r\nimport { User } from '@/types';\r\nimport { Loader2, Upload, Plus, RefreshCw, Filter, Users, Trash2, X, Search, ChevronLeft } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport Link from 'next/link';\r\n\r\nexport default function ProjectLeadsPage({ params }: { params: Promise<{ projectId: string }> }) {\r\n    const { projectId } = use(params);\r\n    const router = useRouter();\r\n    const [user, setUser] = useState<User | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [project, setProject] = useState<any>(null);\r\n    const [showAddModal, setShowAddModal] = useState(false);\r\n    const [showFilters, setShowFilters] = useState(false);\r\n    const [filters, setFilters] = useState({\r\n        search: '',\r\n        status: 'All Statuses',\r\n        category: 'All Categories',\r\n        created: 'Any time'\r\n    });\r\n\r\n    const [newLead, setNewLead] = useState({\r\n        name: '',\r\n        company: '',\r\n        email: '',\r\n        phone: '',\r\n        status: 'Not Interested',\r\n        assignedAgentId: ''\r\n    });\r\n    const [agents, setAgents] = useState<any[]>([]);\r\n\r\n    useEffect(() => {\r\n        // Fetch User and Project info\r\n        const fetchData = async () => {\r\n            try {\r\n                const [userRes, projectsRes] = await Promise.all([\r\n                    fetch('/api/auth/me'),\r\n                    fetch('/api/projects')\r\n                ]);\r\n\r\n                if (userRes.status === 401) {\r\n                    router.push('/login');\r\n                    return;\r\n                }\r\n\r\n                const userData = await userRes.json();\r\n                setUser(userData.user);\r\n\r\n                const projects = await projectsRes.json();\r\n                const currentProject = projects.find((p: any) => p.id === projectId);\r\n                setProject(currentProject);\r\n\r\n                // Fetch agents for project assignment if admin\r\n                if (userData.user.role === 'SUPER_ADMIN' || userData.user.role === 'ADMIN') {\r\n                    const agentsRes = await fetch('/api/users');\r\n                    if (agentsRes.ok) {\r\n                        const allUsers = await agentsRes.json();\r\n                        setAgents(allUsers.filter((u: any) => u.role === 'AGENT'));\r\n                    }\r\n                }\r\n\r\n                setLoading(false);\r\n            } catch (error) {\r\n                console.error('Error fetching data:', error);\r\n                setLoading(false);\r\n            }\r\n        };\r\n        fetchData();\r\n    }, [projectId, router]);\r\n\r\n    const handleRefresh = () => {\r\n        window.location.reload();\r\n    };\r\n\r\n    const handleImport = () => {\r\n        alert('Import CSV functionality coming soon!');\r\n    };\r\n\r\n    const handleAddLead = async () => {\r\n        if (!newLead.name) {\r\n            toast.error('Lead name is required');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const res = await fetch('/api/leads', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ ...newLead, projectId })\r\n            });\r\n\r\n            if (res.ok) {\r\n                toast.success('Lead added successfully!');\r\n                setShowAddModal(false);\r\n                setNewLead({ name: '', company: '', email: '', phone: '', status: 'Not Interested', assignedAgentId: '' });\r\n                // We can invalidate query instead of reload if using react-query properly\r\n                // Since LeadGrid uses react-query, we might need a way to trigger refetch\r\n                window.location.reload();\r\n            } else {\r\n                toast.error('Failed to add lead');\r\n            }\r\n        } catch (error) {\r\n            toast.error('Error adding lead');\r\n        }\r\n    };\r\n\r\n    const handleDeleteSelected = () => {\r\n        alert('Delete Selected functionality coming soon!');\r\n    };\r\n\r\n    const handleBulkAssign = () => {\r\n        alert('Bulk Assign functionality coming soon!');\r\n    };\r\n\r\n    const handleShowFilters = () => {\r\n        setShowFilters(!showFilters);\r\n    };\r\n\r\n    const applyFilters = () => {\r\n        toast.info('Filters applied');\r\n    };\r\n\r\n    const clearFilters = () => {\r\n        setFilters({\r\n            search: '',\r\n            status: 'All Statuses',\r\n            category: 'All Categories',\r\n            created: 'Any time'\r\n        });\r\n        toast.info('Filters cleared');\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"h-screen flex items-center justify-center\">\r\n                <Loader2 className=\"w-8 h-8 animate-spin text-blue-500\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!user || !project) return null;\r\n\r\n    return (\r\n        <div className=\"h-full flex flex-col bg-slate-900 overflow-hidden\">\r\n            {/* Header Toolbar */}\r\n            <div className=\"bg-slate-800 border-b border-slate-700 px-6 py-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <Link href=\"/leads\" className=\"p-2 hover:bg-slate-700 rounded-lg transition-colors text-slate-400 hover:text-white\">\r\n                            <ChevronLeft className=\"w-6 h-6\" />\r\n                        </Link>\r\n                        <div>\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <h1 className=\"text-2xl font-bold text-white\">{project.name}</h1>\r\n                                <span className=\"px-2 py-0.5 bg-blue-600/20 text-blue-400 text-xs font-medium rounded border border-blue-600/30\">Project</span>\r\n                            </div>\r\n                            <p className=\"text-sm text-slate-400 mt-1\">{project.description || 'Project leads and management'}</p>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        {(user?.role === 'SUPER_ADMIN' || user?.permissions?.includes('delete_leads')) && (\r\n                            <button\r\n                                onClick={handleDeleteSelected}\r\n                                className=\"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors text-sm\"\r\n                            >\r\n                                <Trash2 className=\"w-4 h-4\" />\r\n                                Delete Selected\r\n                            </button>\r\n                        )}\r\n                        <button\r\n                            onClick={handleBulkAssign}\r\n                            className=\"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors text-sm\"\r\n                        >\r\n                            <Users className=\"w-4 h-4\" />\r\n                            Bulk Assign\r\n                        </button>\r\n                        <button\r\n                            onClick={handleShowFilters}\r\n                            className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors text-sm ${showFilters ? 'bg-blue-600 text-white' : 'bg-slate-700 hover:bg-slate-600 text-white'}`}\r\n                        >\r\n                            <Filter className=\"w-4 h-4\" />\r\n                            {showFilters ? 'Hide Filters' : 'Show Filters'}\r\n                        </button>\r\n                        <button\r\n                            onClick={handleRefresh}\r\n                            className=\"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors text-sm\"\r\n                        >\r\n                            <RefreshCw className=\"w-4 h-4\" />\r\n                            Refresh\r\n                        </button>\r\n                        <button\r\n                            onClick={handleImport}\r\n                            className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm\"\r\n                        >\r\n                            <Upload className=\"w-4 h-4\" />\r\n                            Import CSV\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setShowAddModal(true)}\r\n                            className=\"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors text-sm\"\r\n                        >\r\n                            <Plus className=\"w-4 h-4\" />\r\n                            Add Lead\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Filter Section */}\r\n            {showFilters && (\r\n                <div className=\"bg-slate-800 border-b border-slate-700 p-6 animate-in slide-in-from-top duration-300\">\r\n                    <div className=\"grid grid-cols-12 gap-6\">\r\n                        <div className=\"col-span-8\">\r\n                            <label className=\"block text-sm font-medium text-slate-300 mb-2\">Search Leads</label>\r\n                            <div className=\"relative\">\r\n                                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400\" />\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={filters.search}\r\n                                    onChange={(e) => setFilters({ ...filters, search: e.target.value })}\r\n                                    className=\"w-full bg-slate-700 border border-slate-600 rounded-lg pl-10 pr-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                                    placeholder=\"Search by name, company, or phone...\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"col-span-4\">\r\n                            <label className=\"block text-sm font-medium text-slate-300 mb-2\">Status</label>\r\n                            <select\r\n                                value={filters.status}\r\n                                onChange={(e) => setFilters({ ...filters, status: e.target.value })}\r\n                                className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                            >\r\n                                <option>All Statuses</option>\r\n                                <option>Not Interested</option>\r\n                                <option>Follow-Up</option>\r\n                                <option>In QC</option>\r\n                                <option>Qualified</option>\r\n                                <option>Scheduled</option>\r\n                                <option>Sales Complete</option>\r\n                            </select>\r\n                        </div>\r\n                        <div className=\"col-span-4 flex items-end justify-end gap-3 mt-4\">\r\n                            <button onClick={applyFilters} className=\"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors\">Apply Filters</button>\r\n                            <button onClick={clearFilters} className=\"px-6 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-medium transition-colors\">Clear All</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Grid */}\r\n            <div className=\"flex-1 overflow-hidden\">\r\n                <LeadGrid user={user} filters={filters} projectId={projectId} />\r\n            </div>\r\n\r\n            {/* Add Lead Modal */}\r\n            {showAddModal && (\r\n                <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50\">\r\n                    <div className=\"bg-slate-800 rounded-xl p-6 w-[500px] border border-slate-700 shadow-2xl\">\r\n                        <div className=\"flex items-center justify-between mb-6\">\r\n                            <h2 className=\"text-xl font-bold text-white\">Add New Lead to {project.name}</h2>\r\n                            <button onClick={() => setShowAddModal(false)} className=\"text-slate-400 hover:text-white transition-colors\">\r\n                                <X className=\"w-5 h-5\" />\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-slate-300 mb-1\">Lead Name *</label>\r\n                                <input type=\"text\" value={newLead.name} onChange={(e) => setNewLead({ ...newLead, name: e.target.value })} className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none\" placeholder=\"Enter lead name\" />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-slate-300 mb-1\">Company</label>\r\n                                <input type=\"text\" value={newLead.company} onChange={(e) => setNewLead({ ...newLead, company: e.target.value })} className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none\" placeholder=\"Enter company\" />\r\n                            </div>\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-slate-300 mb-1\">Email</label>\r\n                                    <input type=\"email\" value={newLead.email} onChange={(e) => setNewLead({ ...newLead, email: e.target.value })} className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none\" placeholder=\"Email\" />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-slate-300 mb-1\">Phone</label>\r\n                                    <input type=\"tel\" value={newLead.phone} onChange={(e) => setNewLead({ ...newLead, phone: e.target.value })} className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none\" placeholder=\"Phone\" />\r\n                                </div>\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-slate-300 mb-1\">Initial Status</label>\r\n                                <select value={newLead.status} onChange={(e) => setNewLead({ ...newLead, status: e.target.value })} className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none\">\r\n                                    <option value=\"Not Interested\">Not Interested</option>\r\n                                    <option value=\"Follow-Up\">Follow-Up</option>\r\n                                    <option value=\"In QC\">In QC</option>\r\n                                    <option value=\"Qualified\">Qualified</option>\r\n                                    <option value=\"Scheduled\">Scheduled</option>\r\n                                </select>\r\n                            </div>\r\n                            {(user.role === 'SUPER_ADMIN' || user.role === 'ADMIN') && (\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-slate-300 mb-1\">Assign Agent</label>\r\n                                    <select\r\n                                        value={newLead.assignedAgentId}\r\n                                        onChange={(e) => setNewLead({ ...newLead, assignedAgentId: e.target.value })}\r\n                                        className=\"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                                    >\r\n                                        <option value=\"\">Select Agent (Optional)</option>\r\n                                        {agents.map(agent => (\r\n                                            <option key={agent.id} value={agent.id}>{agent.name}</option>\r\n                                        ))}\r\n                                    </select>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                        <div className=\"flex gap-3 mt-8\">\r\n                            <button onClick={handleAddLead} className=\"flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg font-semibold transition-colors\">Create Lead</button>\r\n                            <button onClick={() => setShowAddModal(false)} className=\"flex-1 bg-slate-700 hover:bg-slate-600 text-white py-2 rounded-lg font-semibold transition-colors\">Cancel</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\(protected)\\leads\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[547,550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[547,550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[766,769],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[766,769],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1795,1798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1795,1798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'project' is assigned a value but never used.","line":70,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":70,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":90,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":90,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":114,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":114,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updatedProject' is assigned a value but never used.","line":133,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":133,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":153,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":153,"endColumn":23}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { User } from '@/types';\r\nimport { Loader2, Plus, Folder, Trash2, X, LayoutGrid, Calendar, ChevronRight, UserCircle } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport Link from 'next/link';\r\n\r\nexport default function LeadsPage() {\r\n    const router = useRouter();\r\n    const [user, setUser] = useState<User | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [projects, setProjects] = useState<any[]>([]);\r\n    const [showAddModal, setShowAddModal] = useState(false);\r\n    const [newProject, setNewProject] = useState({ name: '', description: '', assignedAgentId: '' });\r\n    const [agents, setAgents] = useState<any[]>([]);\r\n\r\n    useEffect(() => {\r\n        const init = async () => {\r\n            try {\r\n                const [userRes, projectsRes] = await Promise.all([\r\n                    fetch('/api/auth/me'),\r\n                    fetch('/api/projects')\r\n                ]);\r\n\r\n                if (userRes.status === 401) {\r\n                    router.push('/login');\r\n                    return;\r\n                }\r\n\r\n                const userData = await userRes.json();\r\n                setUser(userData.user);\r\n\r\n                const projectsData = await projectsRes.json();\r\n                setProjects(Array.isArray(projectsData) ? projectsData : []);\r\n\r\n                // Fetch agents if user is admin\r\n                if (userData.user.role === 'SUPER_ADMIN' || userData.user.role === 'ADMIN') {\r\n                    const agentsRes = await fetch('/api/users');\r\n                    if (agentsRes.ok) {\r\n                        const allUsers = await agentsRes.json();\r\n                        setAgents(allUsers.filter((u: any) => u.role === 'AGENT'));\r\n                    }\r\n                }\r\n\r\n                setLoading(false);\r\n            } catch (error) {\r\n                console.error('Initialization error:', error);\r\n                setLoading(false);\r\n            }\r\n        };\r\n        init();\r\n    }, [router]);\r\n\r\n    const handleAddProject = async () => {\r\n        if (!newProject.name) {\r\n            toast.error('Project name is required');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const res = await fetch('/api/projects', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(newProject)\r\n            });\r\n\r\n            if (res.ok) {\r\n                const project = await res.json();\r\n\r\n                // If we assigned an agent, we need to locally update the project to include that structure for immediate display if needed\r\n                // But the simple refresh or append is fine.\r\n                // However, our get returns 'assignedUsers' array, POST might return it or not depending on include.\r\n                // Let's refetch or just manually patch it for UI consistency if critical.\r\n                // Re-fetching all projects is safest but overkill. appending is faster. \r\n                // Let's assume the server response includes what we need or we reload list.\r\n                // Actually server response for create usually doesn't include relations unless specified.\r\n                // Let's just reload page or fetch projects again to be safe and consistent.\r\n\r\n                const projectsRes = await fetch('/api/projects');\r\n                const projectsData = await projectsRes.json();\r\n                setProjects(Array.isArray(projectsData) ? projectsData : []);\r\n\r\n                toast.success('Project created successfully!');\r\n                setShowAddModalUnset();\r\n            } else {\r\n                toast.error('Failed to create project');\r\n            }\r\n        } catch (error) {\r\n            toast.error('Error creating project');\r\n        }\r\n    };\r\n\r\n    const setShowAddModalUnset = () => {\r\n        setShowAddModal(false);\r\n        setNewProject({ name: '', description: '', assignedAgentId: '' });\r\n    };\r\n\r\n    const handleDeleteProject = async (e: React.MouseEvent, id: string) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        if (!confirm('Are you sure? This will delete all leads inside this project.')) return;\r\n\r\n        try {\r\n            const res = await fetch(`/api/projects/${id}`, { method: 'DELETE' });\r\n            if (res.ok) {\r\n                setProjects(projects.filter(p => p.id !== id));\r\n                toast.success('Project deleted');\r\n            } else {\r\n                toast.error('Failed to delete project');\r\n            }\r\n        } catch (error) {\r\n            toast.error('Error deleting project');\r\n        }\r\n    };\r\n\r\n    const handleAssignAgent = async (e: React.ChangeEvent<HTMLSelectElement>, projectId: string) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const agentId = e.target.value;\r\n\r\n        try {\r\n            const res = await fetch(`/api/projects/${projectId}`, {\r\n                method: 'PATCH',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ assignedAgentId: agentId })\r\n            });\r\n\r\n            if (res.ok) {\r\n                const updatedProject = await res.json();\r\n                // Update local state\r\n                // Note: The PATCH response might not include the full nested assignedUsers if not careful.\r\n                // It's better to refetch or manually update the name if we have it in the agents list.\r\n                const agentName = agents.find(a => a.id === agentId)?.name || '';\r\n\r\n                setProjects(projects.map(p => {\r\n                    if (p.id === projectId) {\r\n                        return {\r\n                            ...p,\r\n                            assignedUsers: agentId ? [{ id: agentId, name: agentName }] : []\r\n                        };\r\n                    }\r\n                    return p;\r\n                }));\r\n\r\n                toast.success('Agent assigned successfully');\r\n            } else {\r\n                toast.error('Failed to assign agent');\r\n            }\r\n        } catch (error) {\r\n            toast.error('Error assigning agent');\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"h-screen flex items-center justify-center bg-slate-900\">\r\n                <div className=\"flex flex-col items-center gap-4\">\r\n                    <Loader2 className=\"w-10 h-10 animate-spin text-blue-500\" />\r\n                    <p className=\"text-slate-400 animate-pulse\">Loading workspace...</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!user) return null;\r\n\r\n    return (\r\n        <div className=\"h-full flex flex-col bg-slate-900 overflow-y-auto\">\r\n            {/* Header */}\r\n            <div className=\"bg-slate-800 border-b border-slate-700 px-8 py-6 sticky top-0 z-10\">\r\n                <div className=\"flex items-center justify-between max-w-7xl mx-auto w-full\">\r\n                    <div>\r\n                        <h1 className=\"text-3xl font-bold text-white flex items-center gap-3\">\r\n                            <LayoutGrid className=\"w-8 h-8 text-blue-500\" />\r\n                            Projects\r\n                        </h1>\r\n                        <p className=\"text-slate-400 mt-1\">Select a project to manage its leads</p>\r\n                    </div>\r\n                    {/* Only Admins should create projects? User requirement is vague but implies \"we\" (admins) assign. */}\r\n                    {(user.role === 'SUPER_ADMIN' || user.role === 'ADMIN') && (\r\n                        <button\r\n                            onClick={() => setShowAddModal(true)}\r\n                            className=\"flex items-center gap-2 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-xl font-semibold transition-all shadow-lg hover:shadow-green-900/20 active:scale-95\"\r\n                        >\r\n                            <Plus className=\"w-5 h-5\" />\r\n                            New Project\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Projects Grid */}\r\n            <div className=\"flex-1 p-8\">\r\n                <div className=\"max-w-7xl mx-auto\">\r\n                    {projects.length === 0 ? (\r\n                        <div className=\"flex flex-col items-center justify-center py-20 bg-slate-800/50 rounded-3xl border-2 border-dashed border-slate-700\">\r\n                            <Folder className=\"w-16 h-16 text-slate-600 mb-4\" />\r\n                            <h2 className=\"text-xl font-semibold text-white\">No projects found</h2>\r\n                            <p className=\"text-slate-400 mt-2 mb-8\">\r\n                                {(user.role === 'SUPER_ADMIN' || user.role === 'ADMIN') ? 'Create your first project to start managing leads' : 'You have not been assigned any projects yet.'}\r\n                            </p>\r\n                            {(user.role === 'SUPER_ADMIN' || user.role === 'ADMIN') && (\r\n                                <button\r\n                                    onClick={() => setShowAddModal(true)}\r\n                                    className=\"px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold transition-all\"\r\n                                >\r\n                                    Get Started\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                            {projects.map((project) => (\r\n                                <div\r\n                                    key={project.id}\r\n                                    className=\"group relative bg-slate-800 border border-slate-700 rounded-2xl p-6 transition-all hover:bg-slate-750 hover:border-blue-500/50 hover:shadow-2xl hover:shadow-blue-900/20 flex flex-col h-full\"\r\n                                >\r\n                                    <div className=\"flex items-start justify-between mb-4\">\r\n                                        <div className=\"p-3 bg-blue-600/10 text-blue-500 rounded-xl group-hover:bg-blue-600 group-hover:text-white transition-all\">\r\n                                            <Folder className=\"w-6 h-6\" />\r\n                                        </div>\r\n                                        <div\r\n                                            className=\"flex items-center gap-2\"\r\n                                            onClick={(e) => e.stopPropagation()}\r\n                                            onMouseDown={(e) => e.stopPropagation()}\r\n                                        >\r\n                                            {(user.role === 'ADMIN' || user.role === 'SUPER_ADMIN') && (\r\n                                                <>\r\n                                                    <select\r\n                                                        value={project.assignedUsers?.[0]?.id || ''}\r\n                                                        onChange={(e) => handleAssignAgent(e, project.id)}\r\n                                                        className=\"bg-slate-900 border border-slate-700 rounded-lg px-2 py-1 text-xs text-white outline-none focus:ring-1 focus:ring-blue-500 transition-all cursor-pointer\"\r\n                                                    >\r\n                                                        <option value=\"\">No Agent</option>\r\n                                                        {agents.map((agent) => (\r\n                                                            <option key={agent.id} value={agent.id}>\r\n                                                                {agent.name}\r\n                                                            </option>\r\n                                                        ))}\r\n                                                    </select>\r\n                                                    <button\r\n                                                        onClick={(e) => handleDeleteProject(e, project.id)}\r\n                                                        className=\"p-2 text-slate-500 hover:text-red-500 hover:bg-red-500/10 rounded-lg transition-all opacity-0 group-hover:opacity-100\"\r\n                                                    >\r\n                                                        <Trash2 className=\"w-5 h-5\" />\r\n                                                    </button>\r\n                                                </>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <h3 className=\"text-xl font-bold text-white mb-2 transition-colors\">\r\n                                        {project.name}\r\n                                    </h3>\r\n\r\n                                    <p className=\"text-slate-400 text-sm line-clamp-2 mb-4 flex-1\">\r\n                                        {project.description || 'No description provided for this project.'}\r\n                                    </p>\r\n\r\n                                    {/* Assigned Agent Display */}\r\n                                    {project.assignedUsers && project.assignedUsers.length > 0 && (\r\n                                        <div className=\"mb-4 flex items-center gap-2 text-sm text-slate-400 bg-slate-900/50 p-2 rounded-lg\">\r\n                                            <UserCircle className=\"w-4 h-4 text-blue-400\" />\r\n                                            <span>Assigned to: <span className=\"text-white font-medium\">{project.assignedUsers[0].name}</span></span>\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    <div className=\"flex items-center justify-between pt-4 border-t border-slate-700/50 mt-auto\">\r\n                                        <div className=\"flex items-center gap-2 text-xs text-slate-500\">\r\n                                            <Calendar className=\"w-3 h-3\" />\r\n                                            {new Date(project.createdAt).toLocaleDateString()}\r\n                                        </div>\r\n                                        <Link\r\n                                            href={`/leads/${project.id}`}\r\n                                            className=\"flex items-center gap-1 text-blue-500 font-bold text-sm hover:text-blue-400 transition-all hover:translate-x-1\"\r\n                                        >\r\n                                            Open Grid\r\n                                            <ChevronRight className=\"w-4 h-4\" />\r\n                                        </Link>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Add Project Modal */}\r\n            {showAddModal && (\r\n                <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n                    <div className=\"bg-slate-800 rounded-3xl p-8 w-full max-w-md border border-slate-700 shadow-2xl animate-in fade-in zoom-in duration-200\">\r\n                        <div className=\"flex items-center justify-between mb-8\">\r\n                            <div>\r\n                                <h2 className=\"text-2xl font-bold text-white\">Create Project</h2>\r\n                                <p className=\"text-slate-400 text-sm mt-1\">Add a new workspace to group leads</p>\r\n                            </div>\r\n                            <button\r\n                                onClick={setShowAddModalUnset}\r\n                                className=\"p-2 hover:bg-slate-700 rounded-full text-slate-400 hover:text-white transition-all\"\r\n                            >\r\n                                <X className=\"w-6 h-6\" />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-6\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-semibold text-slate-300 mb-2 ml-1\">Project Name</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={newProject.name}\r\n                                    onChange={(e) => setNewProject({ ...newProject, name: e.target.value })}\r\n                                    className=\"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-blue-500 outline-none transition-all placeholder:text-slate-600\"\r\n                                    placeholder=\"e.g., My New Project\"\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-sm font-semibold text-slate-300 mb-2 ml-1\">Assign to Agent (Optional)</label>\r\n                                <select\r\n                                    value={newProject.assignedAgentId}\r\n                                    onChange={(e) => setNewProject({ ...newProject, assignedAgentId: e.target.value })}\r\n                                    className=\"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-blue-500 outline-none transition-all\"\r\n                                >\r\n                                    <option value=\"\">Select an Agent...</option>\r\n                                    {agents.map((agent) => (\r\n                                        <option key={agent.id} value={agent.id}>\r\n                                            {agent.name}\r\n                                        </option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-sm font-semibold text-slate-300 mb-2 ml-1\">Description (Optional)</label>\r\n                                <textarea\r\n                                    value={newProject.description}\r\n                                    onChange={(e) => setNewProject({ ...newProject, description: e.target.value })}\r\n                                    className=\"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-blue-500 outline-none transition-all placeholder:text-slate-600 min-h-[100px]\"\r\n                                    placeholder=\"What is this project about?\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex gap-4 mt-10\">\r\n                            <button\r\n                                onClick={handleAddProject}\r\n                                className=\"flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-xl font-bold transition-all shadow-lg shadow-blue-900/20\"\r\n                            >\r\n                                Create Project\r\n                            </button>\r\n                            <button\r\n                                onClick={setShowAddModalUnset}\r\n                                className=\"flex-1 bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-xl font-bold transition-all\"\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\(protected)\\proposals\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\(protected)\\reports\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'COLORS' is assigned a value but never used.","line":8,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { Loader2, TrendingUp, Users, Activity } from 'lucide-react';\r\nimport { format } from 'date-fns';\r\nimport { ActivityLog } from '@/types';\r\n\r\nconst COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8', '#82ca9d'];\r\n\r\nexport default function ReportsPage() {\r\n    const { data, isLoading } = useQuery({\r\n        queryKey: ['reports'],\r\n        queryFn: async () => {\r\n            const res = await fetch('/api/reports');\r\n            if (!res.ok) throw new Error('Failed to fetch');\r\n            return res.json();\r\n        }\r\n    });\r\n\r\n    if (isLoading) return <div className=\"flex items-center justify-center h-full text-slate-400\"><Loader2 className=\"animate-spin mr-2\" /> Loading Report...</div>;\r\n\r\n    const chartData = data?.statusCounts.map((item: { status: string; _count: { status: number } }) => ({\r\n        name: item.status,\r\n        value: item._count.status\r\n    })) || [];\r\n\r\n    return (\r\n        <div className=\"space-y-6 max-w-6xl mx-auto pb-10\">\r\n            <h1 className=\"text-2xl font-bold text-white mb-6\">Monthly Performance Report</h1>\r\n\r\n            {/* Top Stats Cards */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                <div className=\"bg-slate-900 border border-slate-800 p-6 rounded-xl\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        <h3 className=\"text-slate-400 text-sm font-medium\">Total Leads</h3>\r\n                        <Users className=\"w-5 h-5 text-blue-400\" />\r\n                    </div>\r\n                    <p className=\"text-3xl font-bold text-white\">\r\n                        {chartData.reduce((acc: number, curr: { value: number }) => acc + curr.value, 0)}\r\n                    </p>\r\n                </div>\r\n                <div className=\"bg-slate-900 border border-slate-800 p-6 rounded-xl\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        <h3 className=\"text-slate-400 text-sm font-medium\">Conversion Rate</h3>\r\n                        <TrendingUp className=\"w-5 h-5 text-green-400\" />\r\n                    </div>\r\n                    {/* Mock conversion calculation */}\r\n                    <p className=\"text-3xl font-bold text-white\">\r\n                        {((chartData.find((c: { name: string; value: number }) => c.name === 'Sale Completed')?.value || 0) / (chartData.reduce((acc: number, curr: { value: number }) => acc + curr.value, 0) || 1) * 100).toFixed(1)}%\r\n                    </p>\r\n                </div>\r\n                <div className=\"bg-slate-900 border border-slate-800 p-6 rounded-xl\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        <h3 className=\"text-slate-400 text-sm font-medium\">Activities</h3>\r\n                        <Activity className=\"w-5 h-5 text-purple-400\" />\r\n                    </div>\r\n                    <p className=\"text-3xl font-bold text-white\">{data?.recentActivity?.length || 0}+</p>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                {/* Status Distribution Chart */}\r\n                <div className=\"bg-slate-900 border border-slate-800 p-6 rounded-xl min-h-[400px]\">\r\n                    <h3 className=\"text-lg font-semibold text-white mb-6\">Lead Status Distribution</h3>\r\n                    <div className=\"h-[300px] flex items-center justify-center text-slate-500\">\r\n                        Chart temporarily disabled for build verification\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Activity Feed */}\r\n                <div className=\"bg-slate-900 border border-slate-800 p-6 rounded-xl min-h-[400px]\">\r\n                    <h3 className=\"text-lg font-semibold text-white mb-6\">Recent Activity</h3>\r\n                    <div className=\"space-y-4 max-h-[300px] overflow-y-auto pr-2\">\r\n                        {data?.recentActivity?.map((log: ActivityLog) => (\r\n                            <div key={log.id} className=\"text-sm border-b border-slate-800 pb-3 last:border-0\">\r\n                                <div className=\"flex justify-between text-slate-400 mb-1\">\r\n                                    <span className=\"font-medium text-white\">{log.user.name}</span>\r\n                                    <span className=\"text-xs\">{format(new Date(log.timestamp), 'MMM dd, HH:mm')}</span>\r\n                                </div>\r\n                                <div className=\"text-slate-500\">\r\n                                    {log.action}: {log.lead.name} ({log.previousStatus} â†’ <span className=\"text-blue-400\">{log.newStatus}</span>)\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                        {(!data?.recentActivity || data.recentActivity.length === 0) && (\r\n                            <p className=\"text-slate-500 text-center py-4\">No recent activity.</p>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\(protected)\\settings\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\(protected)\\team\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\(protected)\\users\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\api\\auth\\login\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\api\\auth\\logout\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\api\\auth\\me\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":12,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { getSession } from \"@/lib/auth\";\r\n\r\nexport async function GET() {\r\n    try {\r\n        const session = await getSession();\r\n        if (!session) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        return NextResponse.json({ user: session });\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Internal error\" }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\api\\dashboard\\stats\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1250,1253],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1250,1253],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2242,2245],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2242,2245],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2356,2359],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2356,2359],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2860,2863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2860,2863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { prismadb } from \"@/lib/prismadb\";\r\nimport { getSession } from \"@/lib/auth\";\r\n\r\nexport async function GET() {\r\n    try {\r\n        const session = await getSession();\r\n        if (!session) return new NextResponse(\"Unauthorized\", { status: 401 });\r\n\r\n        let workspaceId = session.workspaceId;\r\n\r\n        // Fallback: If workspaceId is missing in session, fetch it from DB\r\n        if (!workspaceId) {\r\n            const user = await prismadb.user.findUnique({\r\n                where: { id: session.id },\r\n                select: { workspaceId: true }\r\n            });\r\n            workspaceId = user?.workspaceId || \"\";\r\n        }\r\n\r\n        if (!workspaceId) {\r\n            // If still no workspace, try to find the first workspace this user belongs to\r\n            const firstWorkspace = await prismadb.workspace.findFirst({\r\n                where: {\r\n                    users: { some: { id: session.id } }\r\n                }\r\n            });\r\n            workspaceId = firstWorkspace?.id || \"\";\r\n        }\r\n\r\n        if (!workspaceId && session.role !== 'SUPER_ADMIN') {\r\n            return new NextResponse(\"No workspace found\", { status: 400 });\r\n        }\r\n\r\n        const whereClause: any = {};\r\n\r\n        // 1. SUPER_ADMIN sees everything.\r\n        // 2. ADMIN sees everything in their workspace.\r\n        // 3. AGENT sees only their assigned projects.\r\n        if (session.role === 'ADMIN') {\r\n            if (workspaceId) {\r\n                whereClause.workspaceId = workspaceId;\r\n            }\r\n        } else if (session.role !== 'SUPER_ADMIN') {\r\n            whereClause.assignedUsers = {\r\n                some: { id: session.id }\r\n            };\r\n        }\r\n\r\n        // Fetch all projects in the workspace (or all for Super Admin if no workspace)\r\n        const projects = await prismadb.project.findMany({\r\n            where: whereClause,\r\n            include: {\r\n                leads: {\r\n                    select: {\r\n                        status: true\r\n                    }\r\n                }\r\n            },\r\n            orderBy: { createdAt: 'desc' }\r\n        });\r\n\r\n        // Aggregate stats per project\r\n        const projectStats = projects.map((project: any) => {\r\n            const statusCounts: Record<string, number> = {};\r\n            project.leads.forEach((lead: any) => {\r\n                statusCounts[lead.status] = (statusCounts[lead.status] || 0) + 1;\r\n            });\r\n\r\n            return {\r\n                id: project.id,\r\n                name: project.name,\r\n                description: project.description,\r\n                totalLeads: project.leads.length,\r\n                statusCounts,\r\n                createdAt: project.createdAt\r\n            };\r\n        });\r\n\r\n        // Global stats\r\n        const totalLeads = projectStats.reduce((sum: number, p: any) => sum + p.totalLeads, 0);\r\n        const totalProjects = projectStats.length;\r\n\r\n        return NextResponse.json({\r\n            totalLeads,\r\n            totalProjects,\r\n            projectStats\r\n        });\r\n    } catch (error) {\r\n        console.error('[DASHBOARD_STATS_GET]', error);\r\n        return new NextResponse(\"Internal Error\", { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\api\\leads\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\api\\leads\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\api\\projects\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2014,2017],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2014,2017],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { prismadb } from \"@/lib/prismadb\";\r\nimport { getSession } from \"@/lib/auth\";\r\n\r\nexport async function DELETE(req: Request, { params }: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const session = await getSession();\r\n        if (!session) return new NextResponse(\"Unauthorized\", { status: 401 });\r\n\r\n        const { id } = await params;\r\n\r\n        // Verify project belongs to workspace\r\n        const project = await prismadb.project.findUnique({\r\n            where: { id }\r\n        });\r\n\r\n        if (!project) return new NextResponse(\"Not Found\", { status: 404 });\r\n\r\n        if (session.role !== 'SUPER_ADMIN' && project.workspaceId !== session.workspaceId) {\r\n            return new NextResponse(\"Forbidden\", { status: 403 });\r\n        }\r\n\r\n        // Delete leads first\r\n        await prismadb.lead.deleteMany({\r\n            where: { projectId: id }\r\n        });\r\n\r\n        await prismadb.project.delete({\r\n            where: { id }\r\n        });\r\n\r\n        return NextResponse.json({ success: true });\r\n    } catch (error) {\r\n        console.error('[PROJECT_DELETE]', error);\r\n        return new NextResponse(\"Internal Error\", { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function PATCH(req: Request, { params }: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const session = await getSession();\r\n        if (!session) return new NextResponse(\"Unauthorized\", { status: 401 });\r\n\r\n        const { id } = await params;\r\n        const body = await req.json();\r\n        const { name, description, assignedAgentId } = body;\r\n\r\n        const existingProject = await prismadb.project.findUnique({\r\n            where: { id }\r\n        });\r\n\r\n        if (!existingProject) return new NextResponse(\"Not Found\", { status: 404 });\r\n\r\n        if (session.role !== 'SUPER_ADMIN' && existingProject.workspaceId !== session.workspaceId) {\r\n            return new NextResponse(\"Forbidden\", { status: 403 });\r\n        }\r\n\r\n        const updateData: any = {};\r\n        if (name) updateData.name = name;\r\n        if (description) updateData.description = description;\r\n\r\n        if (assignedAgentId !== undefined) {\r\n            updateData.assignedUsers = {\r\n                set: assignedAgentId ? [{ id: assignedAgentId }] : []\r\n            };\r\n        }\r\n\r\n        const project = await prismadb.project.update({\r\n            where: { id },\r\n            data: updateData\r\n        });\r\n\r\n        return NextResponse.json(project);\r\n    } catch (error) {\r\n        console.error('[PROJECT_PATCH]', error);\r\n        return new NextResponse(\"Internal Error\", { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\api\\projects\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[330,333],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[330,333],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2860,2863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2860,2863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { prismadb } from \"@/lib/prismadb\";\r\nimport { getSession } from \"@/lib/auth\";\r\n\r\nexport async function GET() {\r\n    try {\r\n        const session = await getSession();\r\n        if (!session) return new NextResponse(\"Unauthorized\", { status: 401 });\r\n\r\n        const whereClause: any = {};\r\n        let workspaceId = session.workspaceId;\r\n\r\n        // Fetch workspaceId if missing\r\n        if (!workspaceId && session.role !== 'SUPER_ADMIN') {\r\n            const user = await prismadb.user.findUnique({\r\n                where: { id: session.id },\r\n                select: { workspaceId: true }\r\n            });\r\n            workspaceId = user?.workspaceId || \"\";\r\n        }\r\n\r\n        // Role-based filtering\r\n        if (session.role === 'SUPER_ADMIN') {\r\n            // Super Admin sees everything across all workspaces\r\n        } else if (session.role === 'ADMIN') {\r\n            // Admin sees all projects in their workspace\r\n            if (workspaceId) {\r\n                whereClause.workspaceId = workspaceId;\r\n            }\r\n        } else {\r\n            // AGENT only sees projects they are specifically assigned to\r\n            whereClause.assignedUsers = {\r\n                some: { id: session.id }\r\n            };\r\n        }\r\n\r\n        const projects = await prismadb.project.findMany({\r\n            where: whereClause,\r\n            orderBy: { createdAt: 'desc' },\r\n            include: {\r\n                assignedUsers: {\r\n                    select: { id: true, name: true, email: true }\r\n                }\r\n            }\r\n        });\r\n\r\n        return NextResponse.json(projects);\r\n    } catch (error) {\r\n        console.error('[PROJECTS_GET]', error);\r\n        return new NextResponse(\"Internal Error\", { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const session = await getSession();\r\n        if (!session) return new NextResponse(\"Unauthorized\", { status: 401 });\r\n\r\n        const body = await req.json();\r\n        const { name, description, assignedAgentId } = body;\r\n\r\n        if (!name) return new NextResponse(\"Name is required\", { status: 400 });\r\n\r\n        let workspaceId: string | undefined | null = session.workspaceId;\r\n\r\n        if (!workspaceId) {\r\n            const user = await prismadb.user.findUnique({\r\n                where: { id: session.id },\r\n                select: { workspaceId: true }\r\n            });\r\n            workspaceId = user?.workspaceId;\r\n        }\r\n\r\n        if (!workspaceId) {\r\n            const defaultWorkspace = await prismadb.workspace.findFirst({\r\n                where: { name: 'Default Workspace' }\r\n            });\r\n            workspaceId = defaultWorkspace?.id;\r\n        }\r\n\r\n        if (!workspaceId) return new NextResponse(\"No workspace found\", { status: 400 });\r\n\r\n        const projectData: any = {\r\n            name,\r\n            description,\r\n            workspaceId: workspaceId as string\r\n        };\r\n\r\n        if (assignedAgentId) {\r\n            projectData.assignedUsers = {\r\n                connect: { id: assignedAgentId }\r\n            };\r\n        }\r\n\r\n        const project = await prismadb.project.create({\r\n            data: projectData\r\n        });\r\n\r\n        return NextResponse.json(project);\r\n    } catch (error) {\r\n        console.error('[PROJECTS_POST]', error);\r\n        return new NextResponse(\"Internal Error\", { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\api\\proposals\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\api\\reports\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":5,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":34,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { prismadb } from \"@/lib/prismadb\";\r\nimport { getSession } from \"@/lib/auth\";\r\n\r\nexport async function GET(req: Request) {\r\n    try {\r\n        const session = await getSession();\r\n        if (!session) return new NextResponse(\"Unauthorized\", { status: 401 });\r\n\r\n        // Simple aggregation: Count leads by status\r\n        const statusCounts = await prismadb.lead.groupBy({\r\n            by: ['status'],\r\n            where: { workspaceId: session.workspaceId },\r\n            _count: { status: true }\r\n        });\r\n\r\n        // Recent Activity for report\r\n        const recentActivity = await prismadb.activityLog.findMany({\r\n            where: {\r\n                lead: { workspaceId: session.workspaceId }\r\n            },\r\n            include: {\r\n                lead: { select: { name: true } },\r\n                user: { select: { name: true } }\r\n            },\r\n            orderBy: { timestamp: 'desc' },\r\n            take: 20\r\n        });\r\n\r\n        return NextResponse.json({\r\n            statusCounts,\r\n            recentActivity\r\n        });\r\n    } catch (error) {\r\n        return new NextResponse(\"Internal Error\", { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\api\\settings\\profile\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[696,699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[696,699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\r\nimport { prismadb } from '@/lib/prismadb'\r\nimport { getSession } from '@/lib/auth'\r\nimport bcrypt from 'bcryptjs'\r\n\r\nexport async function PATCH(req: Request) {\r\n    const session = await getSession()\r\n    if (!session) {\r\n        return new NextResponse('Unauthorized', { status: 401 })\r\n    }\r\n\r\n    try {\r\n        const body = await req.json()\r\n        const { name, currentPassword, newPassword } = body\r\n\r\n        const user = await prismadb.user.findUnique({\r\n            where: { id: session.id }\r\n        })\r\n\r\n        if (!user) {\r\n            return new NextResponse('User not found', { status: 404 })\r\n        }\r\n\r\n        const updateData: any = {}\r\n\r\n        if (name) updateData.name = name\r\n\r\n        // Password Change Logic\r\n        if (currentPassword && newPassword) {\r\n            const isPasswordValid = await bcrypt.compare(currentPassword, user.password)\r\n\r\n            if (!isPasswordValid && !user.password.startsWith('$2a$12$e.g.')) {\r\n                // Allow bypass for seed users if needed, but safer to just fail\r\n                return new NextResponse('Invalid current password', { status: 400 })\r\n            }\r\n\r\n            const hashedNewPassword = await bcrypt.hash(newPassword, 12)\r\n            updateData.password = hashedNewPassword\r\n        }\r\n\r\n        const updatedUser = await prismadb.user.update({\r\n            where: { id: session.id },\r\n            data: updateData\r\n        })\r\n\r\n        return NextResponse.json({\r\n            name: updatedUser.name,\r\n            email: updatedUser.email\r\n        })\r\n\r\n    } catch (error) {\r\n        console.error('[SETTINGS_PROFILE_PATCH]', error)\r\n        return new NextResponse('Internal Error', { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\api\\social\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":5,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":16,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":40,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { prismadb } from \"@/lib/prismadb\";\r\nimport { getSession } from \"@/lib/auth\";\r\n\r\nexport async function GET(req: Request) {\r\n    try {\r\n        const session = await getSession();\r\n        if (!session) return new NextResponse(\"Unauthorized\", { status: 401 });\r\n\r\n        const posts = await prismadb.socialPost.findMany({\r\n            where: { workspaceId: session.workspaceId },\r\n            orderBy: { createdAt: 'desc' }\r\n        });\r\n\r\n        return NextResponse.json(posts);\r\n    } catch (error) {\r\n        return new NextResponse(\"Internal Error\", { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const session = await getSession();\r\n        if (!session) return new NextResponse(\"Unauthorized\", { status: 401 });\r\n\r\n        const body = await req.json();\r\n        const { content, platform, scheduledFor } = body;\r\n\r\n        const post = await prismadb.socialPost.create({\r\n            data: {\r\n                workspaceId: session.workspaceId,\r\n                content,\r\n                platform,\r\n                scheduledFor: scheduledFor ? new Date(scheduledFor) : null,\r\n                status: 'DRAFT'\r\n            }\r\n        });\r\n\r\n        return NextResponse.json(post);\r\n    } catch (error) {\r\n        return new NextResponse(\"Internal Error\", { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\api\\users\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[618,621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[618,621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is assigned a value but never used.","line":38,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":28}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\r\nimport { prismadb } from '@/lib/prismadb'\r\nimport { getSession } from '@/lib/auth'\r\nimport bcrypt from 'bcryptjs'\r\n\r\nexport async function PATCH(\r\n    req: Request,\r\n    { params }: { params: Promise<{ id: string }> }\r\n) {\r\n    const session = await getSession()\r\n    if (!session || session.role !== 'SUPER_ADMIN') {\r\n        return new NextResponse('Unauthorized', { status: 401 })\r\n    }\r\n\r\n    const { id } = await params\r\n\r\n    try {\r\n        const body = await req.json()\r\n        const { name, email, role, permissions, password } = body\r\n\r\n        const updateData: any = {\r\n            name,\r\n            email,\r\n            role,\r\n            permissions: JSON.stringify(permissions || [])\r\n        }\r\n\r\n        if (password && password.trim() !== '') {\r\n            updateData.password = await bcrypt.hash(password, 12)\r\n        }\r\n\r\n        const user = await prismadb.user.update({\r\n            where: { id },\r\n            data: updateData\r\n        })\r\n\r\n        // Remove password from response\r\n        const { password: _, ...userWithoutPassword } = user\r\n\r\n        return NextResponse.json({\r\n            ...userWithoutPassword,\r\n            permissions: JSON.parse(user.permissions)\r\n        })\r\n    } catch (error) {\r\n        console.error('[USER_PATCH]', error)\r\n        return new NextResponse('Internal Error', { status: 500 })\r\n    }\r\n}\r\n\r\nexport async function DELETE(\r\n    req: Request,\r\n    { params }: { params: Promise<{ id: string }> }\r\n) {\r\n    const session = await getSession()\r\n    if (!session || session.role !== 'SUPER_ADMIN') {\r\n        return new NextResponse('Unauthorized', { status: 401 })\r\n    }\r\n\r\n    const { id } = await params\r\n\r\n    if (id === session.id) {\r\n        return new NextResponse('Cannot delete yourself', { status: 400 })\r\n    }\r\n\r\n    try {\r\n        await prismadb.user.delete({\r\n            where: { id }\r\n        })\r\n\r\n        return new NextResponse('User deleted', { status: 200 })\r\n    } catch (error) {\r\n        console.error('[USER_DELETE]', error)\r\n        return new NextResponse('Internal Error', { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\api\\users\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is assigned a value but never used.","line":75,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\r\nimport { prismadb } from '@/lib/prismadb'\r\nimport { getSession } from '@/lib/auth'\r\nimport bcrypt from 'bcryptjs'\r\nimport { User } from '@prisma/client'\r\n\r\nexport async function GET() {\r\n    const session = await getSession()\r\n    if (!session || !['SUPER_ADMIN', 'ADMIN'].includes(session.role)) {\r\n        return new NextResponse('Unauthorized', { status: 401 })\r\n    }\r\n\r\n    try {\r\n        const users = await prismadb.user.findMany({\r\n            orderBy: { createdAt: 'desc' },\r\n            select: {\r\n                id: true,\r\n                name: true,\r\n                email: true,\r\n                role: true,\r\n                permissions: true,\r\n                createdAt: true,\r\n                workspaceId: true,\r\n            }\r\n        })\r\n\r\n        const parsedUsers = users.map(u => ({\r\n            ...u,\r\n            permissions: u.permissions ? JSON.parse(u.permissions) : []\r\n        }))\r\n\r\n        return NextResponse.json(parsedUsers)\r\n    } catch (error) {\r\n        console.error('[USERS_GET]', error)\r\n        return new NextResponse('Internal Error', { status: 500 })\r\n    }\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n    const session = await getSession()\r\n    if (!session || session.role !== 'SUPER_ADMIN') {\r\n        return new NextResponse('Unauthorized', { status: 401 })\r\n    }\r\n\r\n    try {\r\n        const body = await req.json()\r\n        const { name, email, password, role, permissions } = body\r\n\r\n        if (!name || !email || !password || !role) {\r\n            return new NextResponse('Missing required fields', { status: 400 })\r\n        }\r\n\r\n        const existingUser = await prismadb.user.findUnique({\r\n            where: { email }\r\n        })\r\n\r\n        if (existingUser) {\r\n            return new NextResponse('User already exists', { status: 400 })\r\n        }\r\n\r\n        const hashedPassword = await bcrypt.hash(password, 12)\r\n\r\n        const user = await prismadb.user.create({\r\n            data: {\r\n                name,\r\n                email,\r\n                password: hashedPassword,\r\n                role,\r\n                permissions: JSON.stringify(permissions || []),\r\n                workspaceId: session.workspaceId // Assign to creator's workspace\r\n            }\r\n        })\r\n\r\n        // Remove password from response\r\n        const { password: _, ...userWithoutPassword } = user\r\n\r\n        return NextResponse.json({\r\n            ...userWithoutPassword,\r\n            permissions: JSON.parse(user.permissions)\r\n        })\r\n    } catch (error) {\r\n        console.error('[USERS_POST]', error)\r\n        return new NextResponse('Internal Error', { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\login\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\app\\providers.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\components\\layout\\Sidebar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isActive' is assigned a value but never used.","line":42,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'active' is assigned a value but never used.","line":44,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { usePathname } from 'next/navigation'\r\nimport Link from 'next/link'\r\nimport { LayoutDashboard, Users, Database, Settings, LogOut, BarChart3, Filter, FileText } from 'lucide-react'\r\nimport { toast } from 'sonner'\r\nimport { useRouter } from 'next/navigation'\r\nimport { cn } from '@/lib/utils'\r\nimport { User } from '@/types'\r\n\r\nexport default function Sidebar({ user }: { user: User }) {\r\n    const pathname = usePathname()\r\n    const router = useRouter()\r\n\r\n    const handleLogout = async () => {\r\n        await fetch('/api/auth/logout', { method: 'POST' })\r\n        toast.success('Logged out')\r\n        router.push('/login')\r\n    }\r\n\r\n    const navItems = [\r\n        { name: 'Dashboard', href: '/dashboard', icon: LayoutDashboard, roles: ['SUPER_ADMIN', 'ADMIN', 'AGENT'] },\r\n        { name: 'All Leads', href: '/leads', icon: Database, roles: ['SUPER_ADMIN', 'ADMIN'] },\r\n        { name: 'My Leads', href: '/leads?view=mine', icon: Filter, roles: ['AGENT'] },\r\n        { name: 'Proposals', href: '/proposals', icon: FileText, roles: ['SUPER_ADMIN', 'ADMIN', 'AGENT'] }, // Was Social\r\n        { name: 'Users', href: '/users', icon: Users, roles: ['SUPER_ADMIN', 'ADMIN'] },\r\n        { name: 'Reports', href: '/reports', icon: BarChart3, roles: ['SUPER_ADMIN', 'ADMIN'] },\r\n        { name: 'Settings', href: '/settings', icon: Settings, roles: ['SUPER_ADMIN'] },\r\n    ]\r\n\r\n    const filteredNav = navItems.filter(item => item.roles.includes(user?.role || 'AGENT'))\r\n\r\n    return (\r\n        <div className=\"h-screen w-64 bg-slate-900 border-r border-slate-800 flex flex-col\">\r\n            <div className=\"p-6\">\r\n                <h1 className=\"text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent\">Golexcel</h1>\r\n                <p className=\"text-xs text-slate-500 mt-1\">{user?.role?.replace('_', ' ')} Workspace</p>\r\n            </div>\r\n\r\n            <nav className=\"flex-1 px-4 space-y-1\">\r\n                {filteredNav.map((item) => {\r\n                    const isActive = pathname === item.href || (pathname.startsWith('/leads') && item.href.startsWith('/leads') && pathname === item.href.split('?')[0] && (item.href.includes('?view=mine') ? pathname.includes('view') : !pathname.includes('view')))\r\n                    // Simple active check logic\r\n                    const active = pathname === item.href.split('?')[0] && (item.href.includes('?view=mine') ? true : true) // Simplification for MVP\r\n\r\n                    return (\r\n                        <Link\r\n                            key={item.href}\r\n                            href={item.href}\r\n                            className={cn(\r\n                                \"flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors\",\r\n                                pathname.startsWith(item.href.split('?')[0])\r\n                                    ? \"bg-blue-600/10 text-blue-400\"\r\n                                    : \"text-slate-400 hover:text-slate-100 hover:bg-slate-800\"\r\n                            )}\r\n                        >\r\n                            <item.icon className=\"w-5 h-5\" />\r\n                            {item.name}\r\n                        </Link>\r\n                    )\r\n                })}\r\n            </nav>\r\n\r\n            <div className=\"p-4 border-t border-slate-800\">\r\n                <div className=\"flex items-center gap-3 px-4 py-3 mb-2\">\r\n                    <div className=\"w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-400 font-bold\">\r\n                        {user?.name?.[0]}\r\n                    </div>\r\n                    <div className=\"flex-1 overflow-hidden\">\r\n                        <p className=\"text-sm font-medium text-white truncate\">{user?.name}</p>\r\n                        <p className=\"text-xs text-slate-500 truncate\">{user?.email}</p>\r\n                    </div>\r\n                </div>\r\n                <button\r\n                    onClick={handleLogout}\r\n                    className=\"w-full flex items-center gap-3 px-4 py-2 text-sm font-medium text-slate-400 hover:text-red-400 hover:bg-red-400/10 rounded-lg transition-colors\"\r\n                >\r\n                    <LogOut className=\"w-5 h-5\" />\r\n                    Sign Out\r\n                </button>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\components\\leads\\LeadGrid.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1125,1128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1125,1128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1241,1244],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1241,1244],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2390,2393],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2390,2393],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":101,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3213,3216],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3213,3216],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3951,3954],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3951,3954],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":141,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4712,4715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4712,4715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":147,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4953,4956],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4953,4956],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":336,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":336,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11721,11724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11721,11724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":349,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":349,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12295,12298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12295,12298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\FBC\\Downloads\\golexcel\\src\\components\\leads\\LeadGrid.tsx:357:9\n  355 |             }\n  356 |         ];\n> 357 |         setColDefs(defs);\n      |         ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  358 |     }, [agents, user.role]);\n  359 |\n  360 |     const onCellValueChanged = useCallback((params: any) => {","line":357,"column":9,"nodeType":null,"endLine":357,"endColumn":19},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'DeleteButtonRenderer' and 'statuses'. Either include them or remove the dependency array.","line":358,"column":8,"nodeType":"ArrayExpression","endLine":358,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [DeleteButtonRenderer, agents, statuses, user.role]","fix":{"range":[12676,12695],"text":"[DeleteButtonRenderer, agents, statuses, user.role]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":360,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":360,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12753,12756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12753,12756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useCallback, useEffect } from 'react';\r\nimport { AgGridReact } from 'ag-grid-react';\r\nimport {\r\n    ColDef,\r\n    ModuleRegistry,\r\n    ClientSideRowModelModule,\r\n    ValidationModule,\r\n    TextEditorModule,\r\n    DateEditorModule,\r\n    SelectEditorModule,\r\n    NumberEditorModule,\r\n    TextFilterModule,\r\n    NumberFilterModule,\r\n    DateFilterModule,\r\n    ExternalFilterModule,\r\n    QuickFilterModule\r\n} from 'ag-grid-community';\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { toast } from 'sonner';\r\nimport { Loader2, Trash2 } from 'lucide-react';\r\nimport { User, Lead } from '@/types';\r\n\r\nimport 'ag-grid-community/styles/ag-theme-quartz.css';\r\n\r\nModuleRegistry.registerModules([\r\n    ClientSideRowModelModule,\r\n    ValidationModule,\r\n    TextEditorModule,\r\n    DateEditorModule,\r\n    SelectEditorModule,\r\n    NumberEditorModule,\r\n    TextFilterModule,\r\n    NumberFilterModule,\r\n    DateFilterModule,\r\n    ExternalFilterModule,\r\n    QuickFilterModule\r\n]);\r\n\r\nexport default function LeadGrid({ user, filters, projectId }: { user: User; filters?: any; projectId?: string }) {\r\n    const queryClient = useQueryClient();\r\n    const [gridApi, setGridApi] = useState<any>(null);\r\n\r\n    // Fetch Leads\r\n    const { data: leads, isLoading } = useQuery<Lead[]>({\r\n        queryKey: ['leads', projectId],\r\n        queryFn: async () => {\r\n            const url = projectId ? `/api/leads?projectId=${projectId}` : '/api/leads';\r\n            const res = await fetch(url);\r\n            if (!res.ok) throw new Error('Failed to fetch leads');\r\n            return res.json();\r\n        }\r\n    });\r\n\r\n    // Apply external filters when filters prop changes\r\n    useEffect(() => {\r\n        if (!gridApi || !filters) return;\r\n\r\n        // 1. Apply Quick Filter (Search)\r\n        gridApi.setGridOption('quickFilterText', filters.search);\r\n\r\n        // 2. Apply Status Filter\r\n        if (filters.status === 'All Statuses') {\r\n            gridApi.setColumnFilterModel('status', null);\r\n        } else {\r\n            gridApi.setColumnFilterModel('status', {\r\n                filterType: 'text',\r\n                type: 'equals',\r\n                filter: filters.status\r\n            });\r\n        }\r\n\r\n        // 3. Grid Filter Refresh\r\n        gridApi.onFilterChanged();\r\n    }, [filters, gridApi]);\r\n\r\n    const onGridReady = (params: any) => {\r\n        setGridApi(params.api);\r\n    };\r\n\r\n    // Update Mutation\r\n    const updateLeadMutation = useMutation({\r\n        mutationFn: async (data: { id: string; changes: Partial<Lead> }) => {\r\n            const res = await fetch(`/api/leads/${data.id}`, {\r\n                method: 'PATCH',\r\n                body: JSON.stringify(data.changes),\r\n                headers: { 'Content-Type': 'application/json' }\r\n            });\r\n\r\n            if (!res.ok) {\r\n                const error = await res.json();\r\n                throw new Error(error.details || 'Failed to update');\r\n            }\r\n            return res.json();\r\n        },\r\n        onSuccess: () => {\r\n            toast.success('Lead updated');\r\n            queryClient.invalidateQueries({ queryKey: ['leads'] });\r\n        },\r\n        onError: (error: any) => {\r\n            toast.error(error.message || 'Failed to update lead');\r\n            queryClient.invalidateQueries({ queryKey: ['leads'] });\r\n        }\r\n    });\r\n\r\n    // Delete Mutation\r\n    const deleteLeadMutation = useMutation({\r\n        mutationFn: async (id: string) => {\r\n            const res = await fetch(`/api/leads/${id}`, { method: 'DELETE' });\r\n            if (!res.ok) throw new Error('Failed to delete');\r\n            return res.json();\r\n        },\r\n        onSuccess: () => {\r\n            toast.success('Lead deleted');\r\n            queryClient.invalidateQueries({ queryKey: ['leads'] });\r\n        },\r\n        onError: () => toast.error('Failed to delete lead')\r\n    });\r\n\r\n    const DeleteButtonRenderer = (props: any) => {\r\n        const canDelete = user.role === 'SUPER_ADMIN' || (user.permissions && user.permissions.includes('delete_leads'));\r\n        if (!canDelete) return null;\r\n\r\n        return (\r\n            <button\r\n                onClick={() => {\r\n                    if (confirm('Are you sure you want to delete this lead?')) {\r\n                        deleteLeadMutation.mutate(props.data.id);\r\n                    }\r\n                }}\r\n                className=\"flex items-center gap-1 px-2 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-xs\"\r\n            >\r\n                <Trash2 className=\"w-3 h-3\" />\r\n                Delete\r\n            </button>\r\n        );\r\n    };\r\n\r\n    // Fetch Agents for dropdown\r\n    const { data: agents } = useQuery<any[]>({\r\n        queryKey: ['agents'],\r\n        queryFn: async () => {\r\n            const res = await fetch('/api/users');\r\n            if (!res.ok) return [];\r\n            const data = await res.json();\r\n            return data.filter((u: any) => u.role === 'AGENT');\r\n        }\r\n    });\r\n\r\n    // All possible statuses\r\n    const statuses = [\r\n        'Not Interested',\r\n        'Follow-Up',\r\n        'In QC',\r\n        'Not Qualified',\r\n        'Qualified',\r\n        'Scheduled',\r\n        'Meeting Complete',\r\n        'Meeting Rescheduled',\r\n        'Proposal Sent',\r\n        'Client Follow-Up',\r\n        'Sales Complete'\r\n    ];\r\n\r\n    // Column Definitions - Traditional Excel Style\r\n    const [colDefs, setColDefs] = useState<ColDef[]>([]);\r\n\r\n    useEffect(() => {\r\n        if (!agents) return;\r\n\r\n        const defs: ColDef[] = [\r\n            {\r\n                headerName: 'Actions',\r\n                width: 80,\r\n                pinned: 'left',\r\n                cellRenderer: DeleteButtonRenderer,\r\n                editable: false,\r\n                filter: false\r\n            },\r\n            {\r\n                field: 'createdAt',\r\n                headerName: 'Date',\r\n                width: 120,\r\n                pinned: 'left',\r\n                editable: false,\r\n                filter: 'agDateColumnFilter',\r\n                valueFormatter: (params) => {\r\n                    if (!params.value) return '';\r\n                    return new Date(params.value).toLocaleDateString();\r\n                }\r\n            },\r\n            {\r\n                field: 'assignedAgentId',\r\n                headerName: 'Agent',\r\n                width: 150,\r\n                editable: user.role !== 'AGENT',\r\n                cellEditor: 'agSelectCellEditor',\r\n                cellEditorParams: {\r\n                    values: agents.map(a => a.id),\r\n                    formatValue: (id: string) => agents.find(a => a.id === id)?.name || 'Unassigned'\r\n                },\r\n                filter: 'agTextColumnFilter',\r\n                valueFormatter: (params) => {\r\n                    return agents.find(a => a.id === params.value)?.name || params.data?.assignedAgent?.name || 'Unassigned';\r\n                }\r\n            },\r\n            {\r\n                field: 'name',\r\n                headerName: 'Prospect Name',\r\n                width: 180,\r\n                editable: true,\r\n                filter: 'agTextColumnFilter',\r\n                cellStyle: { backgroundColor: '#f1f5f9' }\r\n            },\r\n            {\r\n                field: 'company',\r\n                headerName: 'Company Name',\r\n                width: 180,\r\n                editable: true,\r\n                filter: 'agTextColumnFilter',\r\n                cellStyle: { backgroundColor: '#f1f5f9' }\r\n            },\r\n            {\r\n                field: 'title',\r\n                headerName: 'Title',\r\n                width: 150,\r\n                editable: true,\r\n                filter: 'agTextColumnFilter'\r\n            },\r\n            {\r\n                field: 'industry',\r\n                headerName: 'Industry',\r\n                width: 150,\r\n                editable: true,\r\n                filter: 'agTextColumnFilter'\r\n            },\r\n            {\r\n                field: 'revenue',\r\n                headerName: 'Revenue Size',\r\n                width: 150,\r\n                editable: true,\r\n                filter: 'agTextColumnFilter'\r\n            },\r\n            {\r\n                field: 'employees',\r\n                headerName: 'Employee Size',\r\n                width: 150,\r\n                editable: true,\r\n                filter: 'agTextColumnFilter'\r\n            },\r\n            {\r\n                field: 'mobile',\r\n                headerName: 'Mobile Number',\r\n                width: 150,\r\n                editable: true,\r\n                filter: 'agTextColumnFilter'\r\n            },\r\n            {\r\n                field: 'phone',\r\n                headerName: 'Direct Number',\r\n                width: 150,\r\n                editable: true,\r\n                filter: 'agTextColumnFilter'\r\n            },\r\n            {\r\n                field: 'corporatePhone',\r\n                headerName: 'Corporate Number',\r\n                width: 150,\r\n                editable: true,\r\n                filter: 'agTextColumnFilter'\r\n            },\r\n            {\r\n                field: 'email',\r\n                headerName: 'Email Address',\r\n                width: 200,\r\n                editable: true,\r\n                filter: 'agTextColumnFilter'\r\n            },\r\n            {\r\n                field: 'state',\r\n                headerName: 'State',\r\n                width: 120,\r\n                editable: true,\r\n                filter: 'agTextColumnFilter'\r\n            },\r\n            {\r\n                field: 'status',\r\n                headerName: 'Status',\r\n                width: 180,\r\n                editable: true,\r\n                cellEditor: 'agSelectCellEditor',\r\n                cellEditorParams: { values: statuses },\r\n                filter: 'agTextColumnFilter',\r\n                cellStyle: (params) => {\r\n                    const status = params.value;\r\n                    if (status === 'Not Interested' || status === 'Not Qualified') {\r\n                        return { backgroundColor: '#fee2e2', color: '#991b1b', fontWeight: 'bold' };\r\n                    } else if (status === 'Sales Complete' || status === 'Qualified') {\r\n                        return { backgroundColor: '#dbeafe', color: '#1e40af', fontWeight: 'bold' };\r\n                    } else if (status === 'In QC' || status === 'Follow-Up' || status === 'Client Follow-Up') {\r\n                        return { backgroundColor: '#fef3c7', color: '#92400e', fontWeight: 'bold' };\r\n                    } else {\r\n                        return { backgroundColor: '#f1f5f9', color: '#0f172a', fontWeight: 'bold' };\r\n                    }\r\n                }\r\n            },\r\n            {\r\n                field: 'nextFollowUp',\r\n                headerName: 'Meeting Date & Time',\r\n                width: 180,\r\n                editable: true,\r\n                filter: 'agDateColumnFilter',\r\n                cellEditor: 'agDateCellEditor',\r\n                valueFormatter: (params) => {\r\n                    if (!params.value) return '';\r\n                    const date = new Date(params.value);\r\n                    return date.toLocaleString();\r\n                }\r\n            },\r\n            {\r\n                field: 'notes',\r\n                headerName: 'Call Notes',\r\n                width: 250,\r\n                editable: true,\r\n                filter: 'agTextColumnFilter',\r\n                cellEditor: 'agLargeTextCellEditor',\r\n                cellEditorParams: { maxLength: 500, rows: 5, cols: 50 }\r\n            },\r\n            {\r\n                field: 'linkedin',\r\n                headerName: 'LinkedIn',\r\n                width: 180,\r\n                editable: true,\r\n                filter: 'agTextColumnFilter',\r\n                cellRenderer: (params: any) => {\r\n                    if (params.value && params.value.startsWith('http')) {\r\n                        return <a href={params.value} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500 hover:underline\">Link</a>;\r\n                    }\r\n                    return params.value;\r\n                }\r\n            },\r\n            {\r\n                field: 'website',\r\n                headerName: 'Website',\r\n                width: 180,\r\n                editable: true,\r\n                filter: 'agTextColumnFilter',\r\n                cellRenderer: (params: any) => {\r\n                    if (params.value && params.value.startsWith('http')) {\r\n                        return <a href={params.value} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500 hover:underline\">Link</a>;\r\n                    }\r\n                    return params.value;\r\n                }\r\n            }\r\n        ];\r\n        setColDefs(defs);\r\n    }, [agents, user.role]);\r\n\r\n    const onCellValueChanged = useCallback((params: any) => {\r\n        if (params.oldValue === params.newValue) return;\r\n        if (!params.colDef.field) return;\r\n\r\n        // Agent restrictions\r\n        if (user.role === 'AGENT') {\r\n            const lockedStatuses = ['Sales Complete', 'Not Qualified'];\r\n            if (params.data.status && lockedStatuses.includes(params.data.status)) {\r\n                toast.error('This lead is locked. Only Admins can edit.');\r\n                params.api.undoCellEditing();\r\n                return;\r\n            }\r\n\r\n            if (params.colDef.field === 'status') {\r\n                const allowedStatuses = ['Not Interested', 'Follow-Up', 'In QC', 'Meeting Rescheduled', 'Scheduled', 'Meeting Complete', 'Client Follow-Up'];\r\n                if (!allowedStatuses.includes(params.newValue)) {\r\n                    toast.error(`You cannot set status to ${params.newValue}. Only Admins can.`);\r\n                    params.api.undoCellEditing();\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n\r\n        updateLeadMutation.mutate({\r\n            id: params.data.id,\r\n            changes: { [params.colDef.field]: params.newValue }\r\n        });\r\n    }, [updateLeadMutation, user.role]);\r\n\r\n    if (isLoading) return (\r\n        <div className=\"h-full flex items-center justify-center\">\r\n            <Loader2 className=\"w-8 h-8 animate-spin text-blue-500\" />\r\n        </div>\r\n    );\r\n\r\n    return (\r\n        <div className=\"ag-theme-quartz-dark h-full\">\r\n            <AgGridReact\r\n                rowData={leads}\r\n                columnDefs={colDefs}\r\n                onGridReady={onGridReady}\r\n                onCellValueChanged={onCellValueChanged}\r\n                defaultColDef={{\r\n                    sortable: true,\r\n                    filter: true,\r\n                    resizable: true,\r\n                    floatingFilter: false\r\n                }}\r\n                suppressCopyRowsToClipboard={true}\r\n                suppressExcelExport={true}\r\n                suppressCsvExport={true}\r\n                animateRows={true}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\components\\proposals\\ProposalManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Trash2' is defined but never used.","line":4,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":54},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":43,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":75,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { FileText, Sparkles, Save, Plus, Copy, Trash2, ArrowRight } from 'lucide-react'\r\nimport { toast } from 'sonner'\r\nimport { useRouter } from 'next/navigation'\r\n\r\ninterface Template {\r\n    id: string\r\n    name: string\r\n    content: string\r\n    prompt?: string\r\n    createdAt: string\r\n}\r\n\r\nexport default function ProposalManager({ initialTemplates }: { initialTemplates: Template[] }) {\r\n    const router = useRouter()\r\n    const [templates, setTemplates] = useState<Template[]>(initialTemplates)\r\n    const [selectedTemplate, setSelectedTemplate] = useState<Template | null>(null)\r\n    const [prompt, setPrompt] = useState('')\r\n    const [generatedContent, setGeneratedContent] = useState('')\r\n    const [isGenerating, setIsGenerating] = useState(false)\r\n    const [isSaving, setIsSaving] = useState(false)\r\n    const [templateName, setTemplateName] = useState('')\r\n    const [view, setView] = useState<'list' | 'create'>('list')\r\n\r\n    const handleGenerate = async () => {\r\n        if (!prompt) return toast.error('Please enter a prompt')\r\n\r\n        setIsGenerating(true)\r\n        try {\r\n            const res = await fetch('/api/proposals', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ action: 'generate', prompt })\r\n            })\r\n\r\n            if (!res.ok) throw new Error('Generation failed')\r\n\r\n            const data = await res.json()\r\n            setGeneratedContent(data.content)\r\n            toast.success('Proposal generated!')\r\n        } catch (error) {\r\n            toast.error('Failed to generate proposal')\r\n        } finally {\r\n            setIsGenerating(false)\r\n        }\r\n    }\r\n\r\n    const handleSave = async () => {\r\n        if (!templateName) return toast.error('Please name your template')\r\n        if (!generatedContent) return toast.error('No content to save')\r\n\r\n        setIsSaving(true)\r\n        try {\r\n            const res = await fetch('/api/proposals', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    action: 'save',\r\n                    name: templateName,\r\n                    content: generatedContent,\r\n                    prompt\r\n                })\r\n            })\r\n\r\n            if (!res.ok) throw new Error('Save failed')\r\n\r\n            const newTemplate = await res.json()\r\n            setTemplates([newTemplate, ...templates])\r\n            setSelectedTemplate(newTemplate)\r\n            setView('list')\r\n            toast.success('Template saved!')\r\n            router.refresh()\r\n        } catch (error) {\r\n            toast.error('Failed to save template')\r\n        } finally {\r\n            setIsSaving(false)\r\n        }\r\n    }\r\n\r\n    const handleCopy = (content: string) => {\r\n        navigator.clipboard.writeText(content)\r\n        toast.success('Copied to clipboard')\r\n    }\r\n\r\n    return (\r\n        <div className=\"flex h-[calc(100vh-8rem)] bg-slate-900 border border-slate-800 rounded-2xl overflow-hidden\">\r\n            {/* Sidebar List */}\r\n            <div className=\"w-1/3 border-r border-slate-800 bg-slate-900/50 flex flex-col\">\r\n                <div className=\"p-4 border-b border-slate-800 flex justify-between items-center\">\r\n                    <h2 className=\"text-lg font-bold text-white\">Templates</h2>\r\n                    <button\r\n                        onClick={() => {\r\n                            setView('create')\r\n                            setGeneratedContent('')\r\n                            setPrompt('')\r\n                            setTemplateName('')\r\n                            setSelectedTemplate(null)\r\n                        }}\r\n                        className=\"p-2 bg-blue-600 hover:bg-blue-500 rounded-lg text-white transition-colors\"\r\n                    >\r\n                        <Plus className=\"w-5 h-5\" />\r\n                    </button>\r\n                </div>\r\n                <div className=\"flex-1 overflow-y-auto p-2 space-y-2\">\r\n                    {templates.map(t => (\r\n                        <button\r\n                            key={t.id}\r\n                            onClick={() => {\r\n                                setSelectedTemplate(t)\r\n                                setGeneratedContent(t.content)\r\n                                setView('create') // Show editor mode when selected\r\n                            }}\r\n                            className={`w-full text-left p-4 rounded-xl transition-all border ${selectedTemplate?.id === t.id ? 'bg-blue-600/10 border-blue-500/50' : 'bg-slate-800/50 border-slate-700 hover:border-slate-600'}`}\r\n                        >\r\n                            <div className=\"flex items-center gap-3 mb-1\">\r\n                                <FileText className=\"w-4 h-4 text-blue-400\" />\r\n                                <span className=\"font-medium text-white truncate\">{t.name}</span>\r\n                            </div>\r\n                            <p className=\"text-xs text-slate-500 line-clamp-2\">{t.content.substring(0, 60)}...</p>\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Main Editing Area */}\r\n            <div className=\"flex-1 flex flex-col bg-slate-950\">\r\n                {view === 'create' ? (\r\n                    <>\r\n                        <div className=\"p-6 border-b border-slate-800 bg-slate-900\">\r\n                            <div className=\"flex gap-4 mb-4\">\r\n                                <div className=\"flex-1\">\r\n                                    <label className=\"block text-xs font-medium text-slate-400 mb-1 ml-1 uppercase tracking-wider\">Proposal Generator Prompt</label>\r\n                                    <div className=\"relative\">\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={prompt}\r\n                                            onChange={e => setPrompt(e.target.value)}\r\n                                            placeholder=\"e.g. Write a proposal for a Website Redesign for a Lawyer...\"\r\n                                            className=\"w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 pr-12 text-white focus:ring-2 focus:ring-blue-500 outline-none\"\r\n                                        />\r\n                                        <button\r\n                                            onClick={handleGenerate}\r\n                                            disabled={isGenerating}\r\n                                            className=\"absolute right-2 top-1.5 p-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors disabled:opacity-50\"\r\n                                        >\r\n                                            {isGenerating ? <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" /> : <ArrowRight className=\"w-5 h-5\" />}\r\n                                        </button>\r\n                                    </div>\r\n                                    <p className=\"text-xs text-slate-500 mt-2 flex items-center gap-1\">\r\n                                        <Sparkles className=\"w-3 h-3 text-yellow-500\" />\r\n                                        AI-Powered Generation\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex-1 p-6 overflow-hidden flex flex-col\">\r\n                            <div className=\"flex items-center justify-between mb-2\">\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={templateName}\r\n                                    onChange={e => setTemplateName(e.target.value)}\r\n                                    placeholder=\"Template Name...\"\r\n                                    className=\"bg-transparent text-xl font-bold text-white focus:outline-none placeholder:text-slate-600\"\r\n                                />\r\n                                <div className=\"flex gap-2\">\r\n                                    <button\r\n                                        onClick={() => handleCopy(generatedContent)}\r\n                                        className=\"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors\"\r\n                                        title=\"Copy to Clipboard\"\r\n                                    >\r\n                                        <Copy className=\"w-5 h-5\" />\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={handleSave}\r\n                                        disabled={isSaving}\r\n                                        className=\"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg transition-colors disabled:opacity-50\"\r\n                                    >\r\n                                        <Save className=\"w-4 h-4\" />\r\n                                        Save Template\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                            <textarea\r\n                                value={generatedContent}\r\n                                onChange={e => setGeneratedContent(e.target.value)}\r\n                                className=\"flex-1 w-full bg-slate-900 border border-slate-800 rounded-xl p-6 text-slate-300 focus:outline-none focus:border-slate-700 resize-none font-mono text-sm leading-relaxed\"\r\n                                placeholder=\"Generated proposal content will appear here...\"\r\n                            />\r\n                        </div>\r\n                    </>\r\n                ) : (\r\n                    <div className=\"flex flex-col items-center justify-center h-full text-slate-500\">\r\n                        <FileText className=\"w-16 h-16 mb-4 opacity-20\" />\r\n                        <p>Select a template or create a new one</p>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\components\\settings\\SettingsView.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'workspaceData' is assigned a value but never used.","line":23,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setWorkspaceData' is assigned a value but never used.","line":23,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1952,1955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1952,1955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":197,"column":83,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[11019,11062],"text":"Manage your organization&apos;s global settings."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[11019,11062],"text":"Manage your organization&lsquo;s global settings."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[11019,11062],"text":"Manage your organization&#39;s global settings."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[11019,11062],"text":"Manage your organization&rsquo;s global settings."},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":204,"column":76,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[11484,11658],"text":"\r\n                                This feature is under development. Soon you&apos;ll be able to manage custom statuses, pipelines, and integrations.\r\n                            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[11484,11658],"text":"\r\n                                This feature is under development. Soon you&lsquo;ll be able to manage custom statuses, pipelines, and integrations.\r\n                            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[11484,11658],"text":"\r\n                                This feature is under development. Soon you&#39;ll be able to manage custom statuses, pipelines, and integrations.\r\n                            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[11484,11658],"text":"\r\n                                This feature is under development. Soon you&rsquo;ll be able to manage custom statuses, pipelines, and integrations.\r\n                            "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { User } from '@/types'\r\nimport { Save, User as UserIcon, Building, Bell, Lock, Shield, Mail } from 'lucide-react'\r\nimport { toast } from 'sonner'\r\nimport { useRouter } from 'next/navigation'\r\n\r\nexport default function SettingsView({ user }: { user: User }) {\r\n    const router = useRouter()\r\n    const [activeTab, setActiveTab] = useState('profile')\r\n    const [isLoading, setIsLoading] = useState(false)\r\n\r\n    // Profile State\r\n    const [profileData, setProfileData] = useState({\r\n        name: user.name,\r\n        currentPassword: '',\r\n        newPassword: '',\r\n        confirmPassword: ''\r\n    })\r\n\r\n    // Workspace State (Mock for now)\r\n    const [workspaceData, setWorkspaceData] = useState({\r\n        name: 'My Workspace',\r\n        domain: 'golexcel.com',\r\n        timezone: 'UTC-5'\r\n    })\r\n\r\n    const handleProfileUpdate = async (e: React.FormEvent) => {\r\n        e.preventDefault()\r\n\r\n        if (profileData.newPassword && profileData.newPassword !== profileData.confirmPassword) {\r\n            toast.error('New passwords do not match')\r\n            return\r\n        }\r\n\r\n        setIsLoading(true)\r\n        try {\r\n            const res = await fetch('/api/settings/profile', {\r\n                method: 'PATCH',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    name: profileData.name,\r\n                    currentPassword: profileData.currentPassword,\r\n                    newPassword: profileData.newPassword\r\n                })\r\n            })\r\n\r\n            if (!res.ok) {\r\n                const text = await res.text()\r\n                throw new Error(text)\r\n            }\r\n\r\n            toast.success('Profile updated successfully')\r\n            setProfileData(prev => ({ ...prev, currentPassword: '', newPassword: '', confirmPassword: '' }))\r\n            router.refresh()\r\n        } catch (error: any) {\r\n            toast.error(error.message)\r\n        } finally {\r\n            setIsLoading(false)\r\n        }\r\n    }\r\n\r\n    const tabs = [\r\n        { id: 'profile', label: 'Profile Settings', icon: UserIcon },\r\n        { id: 'workspace', label: 'Workspace', icon: Building, show: user.role === 'SUPER_ADMIN' },\r\n        { id: 'notifications', label: 'Notifications', icon: Bell },\r\n    ]\r\n\r\n    return (\r\n        <div className=\"flex bg-slate-900 min-h-[calc(100vh-4rem)] rounded-2xl border border-slate-800 overflow-hidden\">\r\n            {/* Sidebar */}\r\n            <div className=\"w-64 border-r border-slate-800 bg-slate-900/50 p-4\">\r\n                <nav className=\"space-y-1\">\r\n                    {tabs.filter(t => t.show !== false).map((tab) => (\r\n                        <button\r\n                            key={tab.id}\r\n                            onClick={() => setActiveTab(tab.id)}\r\n                            className={`\r\n                                w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-lg transition-colors\r\n                                ${activeTab === tab.id\r\n                                    ? 'bg-blue-600/10 text-blue-400'\r\n                                    : 'text-slate-400 hover:text-slate-200 hover:bg-slate-800'\r\n                                }\r\n                            `}\r\n                        >\r\n                            <tab.icon className=\"w-5 h-5\" />\r\n                            {tab.label}\r\n                        </button>\r\n                    ))}\r\n                </nav>\r\n            </div>\r\n\r\n            {/* Content */}\r\n            <div className=\"flex-1 p-8 bg-slate-900\">\r\n                {activeTab === 'profile' && (\r\n                    <div className=\"max-w-xl mx-auto space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n                        <div>\r\n                            <h2 className=\"text-2xl font-bold text-white mb-2\">Profile Settings</h2>\r\n                            <p className=\"text-slate-400\">Manage your personal account information and security.</p>\r\n                        </div>\r\n\r\n                        <div className=\"bg-slate-800/50 rounded-xl p-6 border border-slate-700/50 space-y-6\">\r\n                            <div className=\"flex items-center gap-4 pb-6 border-b border-slate-700/50\">\r\n                                <div className=\"w-20 h-20 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-3xl font-bold text-white shadow-xl\">\r\n                                    {user.name.charAt(0)}\r\n                                </div>\r\n                                <div>\r\n                                    <h3 className=\"text-lg font-semibold text-white\">{user.name}</h3>\r\n                                    <div className=\"flex items-center gap-2 text-slate-400 text-sm mt-1\">\r\n                                        <Shield className=\"w-3 h-3\" />\r\n                                        <span>{user.role.replace('_', ' ')}</span>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-2 text-slate-400 text-sm\">\r\n                                        <Mail className=\"w-3 h-3\" />\r\n                                        <span>{user.email}</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <form onSubmit={handleProfileUpdate} className=\"space-y-6\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-slate-300 mb-2\">Display Name</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={profileData.name}\r\n                                        onChange={e => setProfileData({ ...profileData, name: e.target.value })}\r\n                                        className=\"w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all\"\r\n                                    />\r\n                                </div>\r\n\r\n                                <div className=\"space-y-4 pt-4 border-t border-slate-700/50\">\r\n                                    <h4 className=\"text-sm font-semibold text-slate-400 uppercase tracking-wider flex items-center gap-2\">\r\n                                        <Lock className=\"w-4 h-4\" /> Change Password\r\n                                    </h4>\r\n\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-medium text-slate-300 mb-2\">Current Password</label>\r\n                                        <input\r\n                                            type=\"password\"\r\n                                            value={profileData.currentPassword}\r\n                                            onChange={e => setProfileData({ ...profileData, currentPassword: e.target.value })}\r\n                                            className=\"w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all\"\r\n                                            placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\r\n                                        />\r\n                                    </div>\r\n\r\n                                    <div className=\"grid grid-cols-2 gap-4\">\r\n                                        <div>\r\n                                            <label className=\"block text-sm font-medium text-slate-300 mb-2\">New Password</label>\r\n                                            <input\r\n                                                type=\"password\"\r\n                                                value={profileData.newPassword}\r\n                                                onChange={e => setProfileData({ ...profileData, newPassword: e.target.value })}\r\n                                                className=\"w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all\"\r\n                                                placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\r\n                                            />\r\n                                        </div>\r\n                                        <div>\r\n                                            <label className=\"block text-sm font-medium text-slate-300 mb-2\">Confirm New Password</label>\r\n                                            <input\r\n                                                type=\"password\"\r\n                                                value={profileData.confirmPassword}\r\n                                                onChange={e => setProfileData({ ...profileData, confirmPassword: e.target.value })}\r\n                                                className=\"w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all\"\r\n                                                placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"flex justify-end pt-4\">\r\n                                    <button\r\n                                        type=\"submit\"\r\n                                        disabled={isLoading}\r\n                                        className=\"flex items-center gap-2 px-6 py-2.5 bg-blue-600 hover:bg-blue-500 text-white font-medium rounded-lg transition-all shadow-lg shadow-blue-500/20 disabled:opacity-50\"\r\n                                    >\r\n                                        {isLoading ? (\r\n                                            <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                                        ) : (\r\n                                            <>\r\n                                                <Save className=\"w-4 h-4\" />\r\n                                                Save Changes\r\n                                            </>\r\n                                        )}\r\n                                    </button>\r\n                                </div>\r\n                            </form>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {activeTab === 'workspace' && (\r\n                    <div className=\"max-w-xl mx-auto space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n                        <div>\r\n                            <h2 className=\"text-2xl font-bold text-white mb-2\">Workspace Settings</h2>\r\n                            <p className=\"text-slate-400\">Manage your organization's global settings.</p>\r\n                        </div>\r\n\r\n                        <div className=\"bg-slate-800/50 rounded-xl p-8 border border-slate-700/50 text-center\">\r\n                            <Building className=\"w-16 h-16 text-slate-600 mx-auto mb-4\" />\r\n                            <h3 className=\"text-lg font-medium text-white mb-2\">Workspace Management Coming Soon</h3>\r\n                            <p className=\"text-slate-400\">\r\n                                This feature is under development. Soon you'll be able to manage custom statuses, pipelines, and integrations.\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {activeTab === 'notifications' && (\r\n                    <div className=\"max-w-xl mx-auto space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n                        <div>\r\n                            <h2 className=\"text-2xl font-bold text-white mb-2\">Notification Preferences</h2>\r\n                            <p className=\"text-slate-400\">Choose how and when you want to be notified.</p>\r\n                        </div>\r\n\r\n                        <div className=\"bg-slate-800/50 rounded-xl p-6 border border-slate-700/50 space-y-4\">\r\n                            {['Lead Assigned', 'Lead Status Change', 'New Comment', 'Daily Digest'].map((item) => (\r\n                                <div key={item} className=\"flex items-center justify-between py-3 border-b border-slate-700/50 last:border-0\">\r\n                                    <div>\r\n                                        <div className=\"font-medium text-white\">{item}</div>\r\n                                        <div className=\"text-xs text-slate-500\">Receive alerts via email and in-app</div>\r\n                                    </div>\r\n                                    <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                                        <input type=\"checkbox\" className=\"sr-only peer\" defaultChecked />\r\n                                        <div className=\"w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600\"></div>\r\n                                    </label>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\components\\users\\UserManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Search' is defined but never used.","line":5,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MoreVertical' is defined but never used.","line":5,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":36},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3562,3565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3562,3565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4119,4122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4119,4122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { User } from '@/types'\r\nimport { Plus, Search, MoreVertical, Shield, Mail, Pencil, Trash2, X, Check, Save } from 'lucide-react'\r\nimport { toast } from 'sonner'\r\nimport { useRouter } from 'next/navigation'\r\n\r\nconst AVAILABLE_PERMISSIONS = [\r\n    { id: 'manage_leads', label: 'Manage Leads', description: 'Create, edit, and assign leads' },\r\n    { id: 'delete_leads', label: 'Delete Leads', description: 'Permanently remove leads' },\r\n    { id: 'view_reports', label: 'View Analytics', description: 'Access dashboard reports' },\r\n    { id: 'manage_team', label: 'Manage Team', description: 'View other team members' },\r\n    { id: 'export_data', label: 'Export Data', description: 'Download data as CSV/Excel' },\r\n    { id: 'manage_settings', label: 'System Settings', description: 'Configure workspace settings' },\r\n]\r\n\r\nconst ROLES = [\r\n    { id: 'SUPER_ADMIN', label: 'Super Admin', color: 'bg-purple-500/10 text-purple-400 border-purple-500/20' },\r\n    { id: 'ADMIN', label: 'Admin', color: 'bg-blue-500/10 text-blue-400 border-blue-500/20' },\r\n    { id: 'AGENT', label: 'Agent', color: 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20' },\r\n]\r\n\r\nexport default function UserManagement({ initialUsers, currentUser }: { initialUsers: User[], currentUser: User }) {\r\n    const [users, setUsers] = useState<User[]>(initialUsers)\r\n    const [isModalOpen, setIsModalOpen] = useState(false)\r\n    const [editingUser, setEditingUser] = useState<User | null>(null)\r\n    const [isLoading, setIsLoading] = useState(false)\r\n    const router = useRouter()\r\n\r\n    const [formData, setFormData] = useState({\r\n        name: '',\r\n        email: '',\r\n        password: '',\r\n        role: 'AGENT',\r\n        permissions: [] as string[]\r\n    })\r\n\r\n    const handleOpenModal = (user?: User) => {\r\n        if (user) {\r\n            setEditingUser(user)\r\n            setFormData({\r\n                name: user.name,\r\n                email: user.email,\r\n                password: '', // Don't show password\r\n                role: user.role,\r\n                permissions: user.permissions || []\r\n            })\r\n        } else {\r\n            setEditingUser(null)\r\n            setFormData({\r\n                name: '',\r\n                email: '',\r\n                password: '',\r\n                role: 'AGENT',\r\n                permissions: []\r\n            })\r\n        }\r\n        setIsModalOpen(true)\r\n    }\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault()\r\n        setIsLoading(true)\r\n\r\n        try {\r\n            const endpoint = editingUser\r\n                ? `/api/users/${editingUser.id}`\r\n                : '/api/users'\r\n\r\n            const method = editingUser ? 'PATCH' : 'POST'\r\n\r\n            const res = await fetch(endpoint, {\r\n                method,\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(formData)\r\n            })\r\n\r\n            if (!res.ok) {\r\n                const error = await res.text()\r\n                throw new Error(error)\r\n            }\r\n\r\n            const savedUser = await res.json()\r\n\r\n            if (editingUser) {\r\n                setUsers(users.map(u => u.id === savedUser.id ? savedUser : u))\r\n                toast.success('User updated successfully')\r\n            } else {\r\n                setUsers([savedUser, ...users])\r\n                toast.success('User created successfully')\r\n            }\r\n            setIsModalOpen(false)\r\n            router.refresh()\r\n        } catch (error: any) {\r\n            toast.error(error.message)\r\n        } finally {\r\n            setIsLoading(false)\r\n        }\r\n    }\r\n\r\n    const handleDelete = async (id: string) => {\r\n        if (!confirm('Are you sure you want to delete this user?')) return\r\n\r\n        try {\r\n            const res = await fetch(`/api/users/${id}`, { method: 'DELETE' })\r\n            if (!res.ok) throw new Error(await res.text())\r\n\r\n            setUsers(users.filter(u => u.id !== id))\r\n            toast.success('User deleted')\r\n            router.refresh()\r\n        } catch (error: any) {\r\n            toast.error(error.message)\r\n        }\r\n    }\r\n\r\n    const togglePermission = (id: string) => {\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            permissions: prev.permissions.includes(id)\r\n                ? prev.permissions.filter(p => p !== id)\r\n                : [...prev.permissions, id]\r\n        }))\r\n    }\r\n\r\n    const canEdit = currentUser.role === 'SUPER_ADMIN'\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold text-white\">User Management</h1>\r\n                    <p className=\"text-slate-400 mt-1\">Manage standard roles and advanced permissions for your team.</p>\r\n                </div>\r\n                {canEdit && (\r\n                    <button\r\n                        onClick={() => handleOpenModal()}\r\n                        className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-all shadow-lg shadow-blue-500/20\"\r\n                    >\r\n                        <Plus className=\"w-5 h-5\" />\r\n                        Add User\r\n                    </button>\r\n                )}\r\n            </div>\r\n\r\n            {/* Users Grid/Table */}\r\n            <div className=\"bg-slate-900/50 border border-slate-800 rounded-xl overflow-hidden backdrop-blur-sm\">\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full text-left\">\r\n                        <thead className=\"bg-slate-900 border-b border-slate-800\">\r\n                            <tr>\r\n                                <th className=\"px-6 py-4 text-xs font-semibold uppercase text-slate-400\">User</th>\r\n                                <th className=\"px-6 py-4 text-xs font-semibold uppercase text-slate-400\">Role</th>\r\n                                <th className=\"px-6 py-4 text-xs font-semibold uppercase text-slate-400\">Permissions</th>\r\n                                <th className=\"px-6 py-4 text-xs font-semibold uppercase text-slate-400 text-right\">Actions</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-slate-800\">\r\n                            {users.map((user) => (\r\n                                <tr key={user.id} className=\"hover:bg-slate-800/50 transition-colors group\">\r\n                                    <td className=\"px-6 py-4\">\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-slate-700 to-slate-800 flex items-center justify-center text-slate-300 font-bold border border-slate-700\">\r\n                                                {user.name.charAt(0)}\r\n                                            </div>\r\n                                            <div>\r\n                                                <div className=\"font-medium text-white group-hover:text-blue-400 transition-colors\">\r\n                                                    {user.name}\r\n                                                </div>\r\n                                                <div className=\"text-sm text-slate-500 flex items-center gap-1\">\r\n                                                    <Mail className=\"w-3 h-3\" />\r\n                                                    {user.email}\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4\">\r\n                                        <span className={`px-3 py-1 rounded-full text-xs font-medium border ${ROLES.find(r => r.id === user.role)?.color}`}>\r\n                                            {user.role.replace('_', ' ')}\r\n                                        </span>\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4\">\r\n                                        <div className=\"flex flex-wrap gap-1\">\r\n                                            {user.role === 'SUPER_ADMIN' ? (\r\n                                                <span className=\"text-xs text-purple-400 font-medium flex items-center gap-1\">\r\n                                                    <Shield className=\"w-3 h-3\" /> Full Access\r\n                                                </span>\r\n                                            ) : user.permissions && user.permissions.length > 0 ? (\r\n                                                user.permissions.slice(0, 3).map(p => (\r\n                                                    <span key={p} className=\"px-2 py-0.5 rounded bg-slate-800 text-slate-400 text-[10px] border border-slate-700\">\r\n                                                        {AVAILABLE_PERMISSIONS.find(ap => ap.id === p)?.label || p}\r\n                                                    </span>\r\n                                                ))\r\n                                            ) : (\r\n                                                <span className=\"text-xs text-slate-600 italic\">No extra permissions</span>\r\n                                            )}\r\n                                            {user.permissions && user.permissions.length > 3 && (\r\n                                                <span className=\"text-[10px] text-slate-500 px-1\">+{user.permissions.length - 3} more</span>\r\n                                            )}\r\n                                        </div>\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4 text-right\">\r\n                                        <div className=\"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                            <button\r\n                                                onClick={() => handleOpenModal(user)}\r\n                                                disabled={!canEdit}\r\n                                                className=\"p-2 hover:bg-blue-500/10 text-slate-400 hover:text-blue-400 rounded-lg transition-colors disabled:opacity-50\"\r\n                                            >\r\n                                                <Pencil className=\"w-4 h-4\" />\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={() => handleDelete(user.id)}\r\n                                                disabled={!canEdit || user.id === currentUser.id}\r\n                                                className=\"p-2 hover:bg-red-500/10 text-slate-400 hover:text-red-400 rounded-lg transition-colors disabled:opacity-50\"\r\n                                            >\r\n                                                <Trash2 className=\"w-4 h-4\" />\r\n                                            </button>\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Modal */}\r\n            {isModalOpen && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm\">\r\n                    <div className=\"bg-slate-900 border border-slate-800 rounded-2xl w-full max-w-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]\">\r\n                        <div className=\"p-6 border-b border-slate-800 flex items-center justify-between\">\r\n                            <h2 className=\"text-xl font-bold text-white\">\r\n                                {editingUser ? 'Edit User' : 'Add New User'}\r\n                            </h2>\r\n                            <button onClick={() => setIsModalOpen(false)} className=\"text-slate-400 hover:text-white\">\r\n                                <X className=\"w-6 h-6\" />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"p-6 overflow-y-auto custom-scrollbar space-y-8\">\r\n                            {/* Basic Info */}\r\n                            <div className=\"space-y-4\">\r\n                                <h3 className=\"text-sm font-semibold text-slate-400 uppercase tracking-wider\">Basic Information</h3>\r\n                                <div className=\"grid grid-cols-2 gap-4\">\r\n                                    <div className=\"space-y-2\">\r\n                                        <label className=\"text-sm font-medium text-slate-300\">Full Name</label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={formData.name}\r\n                                            onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                                            className=\"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-blue-500 transition-colors\"\r\n                                            placeholder=\"John Doe\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className=\"space-y-2\">\r\n                                        <label className=\"text-sm font-medium text-slate-300\">Email Address</label>\r\n                                        <input\r\n                                            type=\"email\"\r\n                                            value={formData.email}\r\n                                            onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                                            className=\"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-blue-500 transition-colors\"\r\n                                            placeholder=\"john@example.com\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className=\"space-y-2 col-span-2\">\r\n                                        <label className=\"text-sm font-medium text-slate-300\">\r\n                                            {editingUser ? 'New Password (leave blank to keep)' : 'Password'}\r\n                                        </label>\r\n                                        <input\r\n                                            type=\"password\"\r\n                                            value={formData.password}\r\n                                            onChange={(e) => setFormData({ ...formData, password: e.target.value })}\r\n                                            className=\"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-blue-500 transition-colors\"\r\n                                            placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Roles & Permissions */}\r\n                            <div className=\"space-y-4\">\r\n                                <h3 className=\"text-sm font-semibold text-slate-400 uppercase tracking-wider\">Role & Access</h3>\r\n\r\n                                <div className=\"grid grid-cols-3 gap-3\">\r\n                                    {ROLES.map((role) => (\r\n                                        <button\r\n                                            key={role.id}\r\n                                            type=\"button\"\r\n                                            onClick={() => setFormData({ ...formData, role: role.id })}\r\n                                            className={`\r\n                                                relative p-4 rounded-lg border text-left transition-all\r\n                                                ${formData.role === role.id\r\n                                                    ? 'bg-blue-600/10 border-blue-500 ring-1 ring-blue-500'\r\n                                                    : 'bg-slate-950 border-slate-800 hover:border-slate-700'\r\n                                                }\r\n                                            `}\r\n                                        >\r\n                                            <div className={`font-semibold mb-1 ${formData.role === role.id ? 'text-blue-400' : 'text-slate-300'}`}>\r\n                                                {role.label}\r\n                                            </div>\r\n                                            {formData.role === role.id && (\r\n                                                <div className=\"absolute top-2 right-2 text-blue-500\">\r\n                                                    <Check className=\"w-4 h-4\" />\r\n                                                </div>\r\n                                            )}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n\r\n                                {formData.role !== 'SUPER_ADMIN' && (\r\n                                    <div className=\"mt-6 border-t border-slate-800 pt-6\">\r\n                                        <label className=\"block text-sm font-medium text-slate-300 mb-4\">Granular Permissions</label>\r\n                                        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\r\n                                            {AVAILABLE_PERMISSIONS.map((perm) => (\r\n                                                <label\r\n                                                    key={perm.id}\r\n                                                    className={`\r\n                                                        flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-all\r\n                                                        ${formData.permissions.includes(perm.id)\r\n                                                            ? 'bg-emerald-500/5 border-emerald-500/30'\r\n                                                            : 'bg-slate-950 border-slate-800 hover:border-slate-700'\r\n                                                        }\r\n                                                    `}\r\n                                                >\r\n                                                    <input\r\n                                                        type=\"checkbox\"\r\n                                                        checked={formData.permissions.includes(perm.id)}\r\n                                                        onChange={() => togglePermission(perm.id)}\r\n                                                        className=\"mt-1 w-4 h-4 rounded border-slate-700 bg-slate-900 text-emerald-500 focus:ring-emerald-500 focus:ring-offset-0\"\r\n                                                    />\r\n                                                    <div>\r\n                                                        <div className={`text-sm font-medium ${formData.permissions.includes(perm.id) ? 'text-emerald-400' : 'text-slate-300'}`}>\r\n                                                            {perm.label}\r\n                                                        </div>\r\n                                                        <p className=\"text-xs text-slate-500\">{perm.description}</p>\r\n                                                    </div>\r\n                                                </label>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"p-6 border-t border-slate-800 flex justify-end gap-3 bg-slate-900/50\">\r\n                            <button\r\n                                onClick={() => setIsModalOpen(false)}\r\n                                className=\"px-4 py-2 text-slate-400 hover:text-white font-medium transition-colors\"\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                            <button\r\n                                onClick={handleSubmit}\r\n                                disabled={isLoading}\r\n                                className=\"px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-medium shadow-lg shadow-blue-500/20 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                            >\r\n                                {isLoading ? (\r\n                                    <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                                ) : (\r\n                                    <>\r\n                                        <Save className=\"w-4 h-4\" />\r\n                                        Save User\r\n                                    </>\r\n                                )}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\lib\\auth.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":19,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { SignJWT, jwtVerify, JWTPayload } from \"jose\";\r\nimport { cookies } from \"next/headers\";\r\n\r\nconst SECRET_KEY = new TextEncoder().encode(\"golexcel-secret-key-change-me\");\r\n\r\nexport async function signSession(payload: JWTPayload) {\r\n    const jwt = await new SignJWT(payload)\r\n        .setProtectedHeader({ alg: \"HS256\" })\r\n        .setIssuedAt()\r\n        .setExpirationTime(\"24h\")\r\n        .sign(SECRET_KEY);\r\n    return jwt;\r\n}\r\n\r\nexport async function verifySession(token: string) {\r\n    try {\r\n        const { payload } = await jwtVerify(token, SECRET_KEY);\r\n        return payload;\r\n    } catch (e) {\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function getSession() {\r\n    const cookieStore = await cookies();\r\n    const token = cookieStore.get(\"session\")?.value;\r\n    if (!token) return null;\r\n    return await verifySession(token) as JWTPayload & { role: string; workspaceId: string; id: string; name: string; email: string; permissions: string[] };\r\n}\r\n\r\nexport async function login(payload: JWTPayload) {\r\n    const token = await signSession(payload);\r\n    const cookieStore = await cookies();\r\n    cookieStore.set(\"session\", token, {\r\n        httpOnly: true,\r\n        secure: process.env.NODE_ENV === \"production\",\r\n        sameSite: \"lax\",\r\n        path: \"/\",\r\n    });\r\n}\r\n\r\nexport async function logout() {\r\n    const cookieStore = await cookies();\r\n    cookieStore.set(\"session\", \"\", { expires: new Date(0) });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\lib\\prismadb.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\FBC\\Downloads\\golexcel\\src\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]